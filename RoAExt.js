'use strict';var modules={jQuery:jQuery};function RoAModule(a){this.name=a}
RoAModule.prototype={name:"NO_NAME",loaded:!1,dependencies:[],addDependency:function(a){this.dependencies.push(a)},checkDependencies:function(){for(var a=0;a<this.dependencies.length;a++){var c=modules[this.dependencies[a]];if(!c||!c.loaded)return console.error("Dependency for module "+this.name+" was not satisfied: "+this.dependencies[a]),!1}return!0},load:function(){this.loaded=!0;var a=" - Loaded Module "+this.name;modules.logger?modules.logger.log(a):console.log(a)}};
Object.spawn=function(a,c){var b={},d;for(d in c)c.hasOwnProperty(d)&&(b[d]={value:c[d],enumerable:!0,configurable:!0,writable:!0});return Object.create(a,b)};
(function(a){function c(a,b,c,d){modules.ajaxHooks.idle=!1;a={id:f++,date:new Date,url:c.url,json:d||{}};m[a.url]&&500>a.date-m[a.url]&&console.warn("Same request was done recently ("+a.url+")");m[a.url]=a.date;r[a.url]&&(r[a.url].locked=!1);for(var e in n)if(a.url===e){for(b=0;b<n[e].length;b++)n[e][b](a);break}for(b=0;b<g.length;b++)g[b](a);modules.ajaxHooks.idle=!0}function b(a,b,c){modules.ajaxHooks.idle=!1;a={id:f++,date:new Date,url:c.url,options:c||{},jqxhr:b};for(var d in l)if(a.url===d){for(b=
0;b<l[d].length;b++)l[d][b](a);break}for(b=0;b<k.length;b++)k[b](a);modules.ajaxHooks.idle=!0}function d(){for(var a in r){var b=r[a];!b.locked&&new Date-(m[a]||0)>=b.interval&&(console.log("Auto-sending ajax for "+a),b.locked=!0,b.ajax||(b.ajax=modules.createAjaxRequest(a).post(b.payload)),b.ajax.send())}}function e(){RoAModule.call(this,"Ajax Hooks")}var f=1,k=[],g=[],n={},l={},m={},r={};e.prototype=Object.spawn(RoAModule.prototype,{idle:!0,registerAutoSend:function(a,b,c){r[a]?console.error("Url "+
a+" is already registered for auto send!"):r[a]={payload:b,interval:c,locked:!1}},register:function(a,b){n[a]||(n[a]=[]);n[a].push(b)},registerRcv:function(a,b){l[a]||(l[a]=[]);l[a].push(b)},registerAll:function(a){g.push(a)},registerRcvAll:function(a){k.push(a)},load:function(){a(document).on("ajaxSend",b);a(document).on("ajaxSuccess",c);modules.createInterval("ajaxHooksAutoSend").set(d,100);RoAModule.prototype.load.apply(this)}});e.prototype.constructor=e;modules.ajaxHooks=new e;modules.ajaxRegisterAutoActions=
function(a){modules.ajaxHooks.register("autobattle.php",a);modules.ajaxHooks.register("autoevent.php",a);modules.ajaxHooks.register("autotrade.php",a);modules.ajaxHooks.register("autocraft.php",a)}})(modules.jQuery);
(function(a){var c=function(a){this.url=a};c.prototype={url:null,args:null,get:function(){return this.custom({method:"GET"})},post:function(a){return this.custom({method:"POST",data:a||{}})},custom:function(b){this.args=a.extend({url:this.url},b||{});return this},send:function(){return a.ajax(this.url,this.args)}};modules.createAjaxRequest=function(a){return new c(a)}})(modules.jQuery);
(function(a){function c(b){var c=a("<select/>"),f={};c.html(b.filter);c.find(">option:not([value=all])").each(function(){var b=a(this);f[b.text().trim()]=parseInt(b.val())});window.sessionStorage.setItem("TRADESKILL_MATERIAL_IDS",JSON.stringify(f));modules.cache.TRADESKILL_MATS=f}function b(){RoAModule.call(this,"Cache")}b.prototype=Object.spawn(RoAModule.prototype,{TRADESKILL_MATS:{},updateIngredientIds:function(){var b=window.sessionStorage.getItem("TRADESKILL_MATERIAL_IDS");b?this.TRADESKILL_MATS=
JSON.parse(b):a.post("market.php",{type:"ingredient",page:0,st:"all"},c)},load:function(){this.updateIngredientIds();RoAModule.prototype.load.apply(this)}});b.prototype.constructor=b;modules.cache=new b})(modules.jQuery);
(function(){function a(){RoAModule.call(this,"Constants")}a.prototype=Object.spawn(RoAModule.prototype,{BaseResourceUrl:"https://cdn.rawgit.com/Craiel/RoAExtRelease/master/",SettingsAutoSaveInterval:1E3,SettingsSaveVersion:1,SettingsSaveKey:"settings",DungeonWallColor:"#ff0000",DungeonRoomSearchedColor:"#ffd700",DungeonRoomHasEnemiesColor:"#ff0000",DungeonPlayerColor:"#ffffff",DungeonMapVersion:.1,HouseUpdateInterval:18E4,ChartUpdateInterval:3E5,HarvestRepeaterMinDelay:15E5});a.prototype.constructor=
a;modules.constants=new a})();(function(a){function c(){RoAModule.call(this,"CSS")}c.prototype=Object.spawn(RoAModule.prototype,{load:function(){var b=a("head"),c;for(c in modules.urls.css)b.append("<link type='text/css' rel='stylesheet' href='"+modules.urls.css[c]+"'/>");RoAModule.prototype.load.apply(this)}});c.prototype.constructor=c;modules.css=new c})(modules.jQuery);
(function(){var a=function(a){this.name=a};a.prototype={intervals:{},isRunning:function(){return"undefined"!==typeof this.intervals[this.name]},clear:function(){return this.isRunning()?(clearInterval(this.intervals[this.name]),delete this.intervals[this.name],!0):!1},set:function(a,b){this.clear();this.intervals[this.name]=setInterval(a,b);return this.intervals[this.name]}};modules.createInterval=function(c){return new a(c)}})();
(function(){function a(){RoAModule.prototype.load.apply(this);modules.logger.log("Loading finished!")}function c(){for(var b=0;b<k.optionals.length;b++)if(!k.optionals[b].loaded)return;g.clear();a()}function b(){g.clear();modules.logger.log("Loading Optionals");for(var a=0;a<k.optionals.length;a++)k.optionals[a].load();g.set(c,1E3)}function d(){g.clear();for(var a=0;a<k.essentials.length;a++)if(!k.essentials[a].loaded)return;g.set(b,1E3)}function e(){g.clear();modules.logger.log("Loading Essentials");
for(var a=0;a<k.essentials.length;a++)k.essentials[a].load();g.set(d,1E3)}function f(){RoAModule.call(this,"Loader")}var k={essentials:[],optionals:[]},g;f.prototype=Object.spawn(RoAModule.prototype,{load:function(){modules.logger.log("Initializing Module Loader");this.loadCallback&&this.loadCallback();g=modules.createInterval("roaLoader");g.set(e,1E3);RoAModule.prototype.load.apply(this)},register:function(a,b){b?k.essentials.push(a):k.optionals.push(a)}});f.prototype.constructor=f;modules.loader=
new f})();(function(){function a(){RoAModule.call(this,"Logger")}a.prototype=Object.spawn(RoAModule.prototype,{formatMessage:function(a,b){b=b||"info";var d=new Date;return"["+(d.getHours()+":"+d.getMinutes()+":"+d.getSeconds())+"] "+GM_info.script.name+"."+b+": "+a},log:function(a){console.log(this.formatMessage(a))},warn:function(a){console.log(this.formatMessage(a))},error:function(a){console.log(this.formatMessage(a))}});a.prototype.constructor=a;modules.logger=new a})();
(function(){function a(a){b&&new Notification("Relics of Avabur",{body:a})}function c(){RoAModule.call(this,"Notifications")}var b=!1;c.prototype=Object.spawn(RoAModule.prototype,{error:function(b){modules.logger.error(b);a("ERROR: "+b)},notice:function(b){modules.logger.log(b);a("NOTE: "+b)},warn:function(b){modules.logger.warn(b);a("WARNING: "+b)},incompatibility:function(a){this.error("Your browser does not support "+a+". Please <a href='https://www.google.co.uk/chrome/browser/desktop/' target='_blank'>Download the latest version of Google Chrome</a>")},
load:function(){"granted"!==Notification.permission?Notification.requestPermission(function(){b=!0}):b=!0;RoAModule.prototype.load.apply(this)}});c.prototype.constructor=c;modules.notification=new c})();
(function(){function a(a){modules.session.lockAutomation=!1}function c(){RoAModule.call(this,"Session")}c.prototype=Object.spawn(RoAModule.prototype,{lockAutomation:!1,dungeonNeedsUpdate:!0,captchaEncountered:function(){modules.settings.settings.notification.captcha.show&&modules.settings.settings.notification.enable&&modules.notification.warn("Captcha required!")},load:function(){modules.ajaxHooks.register("captcha_submit.php",a);RoAModule.prototype.load.apply(this)}});c.prototype.constructor=c;
modules.session=new c})();
(function(){function a(){RoAModule.call(this,"URLS")}var c=function(a){return modules.constants.BaseResourceUrl+a};a.prototype=Object.spawn(RoAModule.prototype,{sfx:{circ_saw:c("sfx/circ_saw.wav"),message_ding:c("sfx/message_ding.wav")},css:{jquery_te:"https://cdnjs.cloudflare.com/ajax/libs/jquery-te/1.4.0/jquery-te.min.css",script:"https://rawgit.com/Craiel/RoAExtRelease/master/RoAExt.css"},gif:{ajax_loader:c("img/ajax-loader.gif")},svg:{sword_clash:c("svg/sword-clash.svg"),log:c("svg/log.svg"),
metal_bar:c("svg/metal-bar.svg"),stone_block:c("svg/stone-block.svg"),fishing:c("svg/fishing.svg")}});a.prototype.constructor=a;modules.urls=new a})();
(function(a){modules.utils={parseTimeStringLong:function(a){var b=0;a=a.match(/([0-9]+\s+(hours?|minutes?|seconds?))/g);for(var d=0;d<a.length;d++)var e=a[d].toLowerCase(),f=e.match(/[0-9]+/),e=-1!==e.indexOf("hour")?36E5:-1!==e.indexOf("minute")?6E4:1E3,b=b+parseInt(f)*e;return b},svg:function(c,b){c.html('<img src="'+modules.urls.gif.ajax_loader+'" alt="Loading"/>');a.get(b).done(function(b){c.html(a(b).find("svg"))});return c},pad:function(a,b,d){a+="";return a.length>=b?a:Array(b-a.length+1).join(d||
"0")+a},getElementIntValue:function(c){return parseInt(a("#"+c).text().replace(/\,/g,""))}}})(modules.jQuery);
(function(a){modules.chartTimeScale={Minute:{title:"Minutes"},Hour:{title:"Hours"},Day:{title:"Days"},Month:{title:"Months"}};var c=function(a,c,e,f){this.id=c;this.data=modules.createChartData();this.initialize(a,c,e,f)};c.prototype={id:"ERR",visible:!1,onBecameVisible:null,toggle:null,target:null,isGameStatChart:!1,isElementChart:!1,gameStatDataPoint:null,elementDataPoint:null,scale:modules.chartTimeScale.Minute,data:null,initialize:function(b,c,e,f){f=f||"line";this.toggleDiv=a("#"+b);this.toggleDiv.click({self:this},
function(a){a.data.self.show()});this.targetDiv=a("#"+c);this.control=new CanvasJS.Chart(c,{title:{text:e},data:[{type:f,color:"blue",dataPoints:[]}],axisX:{title:"Time"},axisY:{title:"Value"}});this.updateControlState()},load:function(a){this.data.load(a);this.updateChartData();this.render()},save:function(){return this.data.save()},reset:function(){this.data.reset();this.updateChartData();this.render()},show:function(){if(!0!==this.visible&&(this.visible=!0,this.updateControlState(),this.render(),
this.onBecameVisible))this.onBecameVisible(this.id)},hide:function(){!1!==this.visible&&(this.visible=!1,this.updateControlState(),this.render())},updateChartData:function(){var a=this.data.getData(this.scale);this.control.options.data[0].dataPoints=[];for(var c=0;c<a.length;c++)this.control.options.data[0].dataPoints.push({label:modules.utils.pad(a[c][0],2),x:c,y:a[c][1]});this.updateChartAxis()},updateChartAxis:function(){for(var a=this.control.options.data[0].dataPoints,c=null,e=null,f=0;f<a.length;f++){if(null===
c||c>a[f].y)c=a[f].y;if(null===e||e<a[f].y)e=a[f].y}this.control.options.axisY.minimum=c;this.control.options.axisY.maximum=e;this.control.options.axisX.title=this.scale.title},updateData:function(a){null==a||isNaN(a)||(this.data.addDataPoint(a),this.updateChartData())},updateDataFromGameStats:function(a){this.isGameStatChart&&this.updateData(a[this.gameStatDataPoint])},updateDataFromElement:function(){var a=modules.utils.getElementIntValue(this.elementDataPoint);this.updateData(a)},asGameStatChart:function(a){this.isGameStatChart=
!0;this.gameStatDataPoint=a;return this},asElementChart:function(a){this.isElementChart=!0;this.elementDataPoint=a;return this},asAdditive:function(){this.data.additive=!0;return this},updateControlState:function(){!1===this.visible?this.targetDiv.hide():this.targetDiv.show()},render:function(){this.control.render()},setTimeScale:function(a){this.scale=a;this.updateChartData();this.render()}};modules.createChart=function(a,d,e,f){return new c(a,d,e,f)}})(modules.jQuery);
(function(){var a=function(){this.reset()};a.prototype={storage:null,additive:!1,addDataPoint:function(a){var b=new Date,d=b.getMinutes(),e=b.getHours(),f=b.getDate(),b=b.getMonth()+1;this.addData("mi",d,a,60);this.addData("h",e,a,720);this.addData("d",f,a,356);this.addData("mo",b,a,60)},addData:function(a,b,d,e){this.storage[a]||(this.storage[a]=[]);if(0<this.storage[a].length){var f=this.storage[a][this.storage[a].length-1];if(f[0]===b){this.additive&&(f[1]+=d);return}}for(this.storage[a].push([b,
d]);this.storage[a].length>e;)this.storage[a].shift()},load:function(a){this.storage=JSON.parse(a);1!==this.storage.version&&(console.warn("Chart data is too old and was reset!"),this.reset())},save:function(){return JSON.stringify(this.storage)},reset:function(){this.storage={version:1,mi:[],h:[],d:[],mo:[]}},getData:function(a){if(a===modules.chartTimeScale.Minute)return this.storage.mi;if(a===modules.chartTimeScale.Hour)return this.storage.h;if(a===modules.chartTimeScale.Day)return this.storage.d;
if(a===modules.chartTimeScale.Month)return this.storage.mo}};modules.createChartData=function(){return new a}})();
(function(a){function c(a){a.json.b&&(a.json.b.xp&&0<a.json.b.xp&&u.chartPlayerBattleXP.updateData(a.json.b.xp),a.json.b.g&&0<a.json.b.g&&u.chartPlayerGoldLooted.updateData(a.json.b.g))}function b(a){a.json.a&&a.json.a.xp&&0<a.json.a.xp&&u.chartPlayerHarvestXP.updateData(a.json.a.xp)}function d(a){a.json.a&&a.json.a.xp&&0<a.json.a.xp&&u.chartPlayerCraftingXP.updateData(a.json.a.xp)}function e(b){for(var c in u)u[c].isGameStatChart?u[c].updateDataFromGameStats(b.json):u[c].isElementChart&&u[c].updateDataFromElement();
g();b={};for(var d in u)b[d]=u[d].save();localStorage.chartData=JSON.stringify(b);a("#gameChartStorageSize").text(2*localStorage.chartData.length)}function f(){if(localStorage.chartData){var a=JSON.parse(localStorage.chartData),b;for(b in a)u[b]&&u[b].load(a[b])}}function k(){if(window.confirm("Reset chart data?"))for(var a in u)u[a].reset()}function g(){z&&z.render()}function n(){z&&console.log(z)}function l(a){for(var b in u)u[b].setTimeScale(a)}function m(){A();a("#gameChartPlayerTabs").show()}
function r(){A();a("#gameChartStatsTabs").show()}function x(){A();a("#gameChartMarketTabs").show()}function A(){a("#gameChartPlayerTabs").hide();a("#gameChartStatsTabs").hide();a("#gameChartMarketTabs").hide()}function q(a,b,c,d){a=modules.createChart(a,b,c,d);u[a.id]=a;a.onBecameVisible=function(a){z!=u[a]&&(z&&z.hide(),z=u[a])};return a}function C(){modules.chartWindow.toggle()}function D(){RoAModule.call(this,"Chart Window")}var v,F,z=null,u={};D.prototype=Object.spawn(RoAModule.prototype,{continueLoad:function(){v=
a(F);v.appendTo("body");v.draggable({handle:"#gameChartTitle"});v.hide();a("#gameChartWindowClose").click(function(){v.hide()});a("#gameChartReset").click(k);a("#gameChartRedraw").click(g);a("#gameChartDebugData").click(n);a("#gameChartTimeMinute").click(function(){l(modules.chartTimeScale.Minute)});a("#gameChartTimeHour").click(function(){l(modules.chartTimeScale.Hour)});a("#gameChartTimeDay").click(function(){l(modules.chartTimeScale.Day)});a("#gameChartTimeMonth").click(function(){l(modules.chartTimeScale.Month)});
a("#toggleGameChartPlayer").click(m);a("#toggleGameChartStats").click(r);a("#toggleGameChartMarket").click(x);m();q("toggleChartPlayerBattleXP","chartPlayerBattleXP","Battle XP","column").asAdditive();q("toggleChartPlayerHarvestXP","chartPlayerHarvestXP","Harvest XP","column").asAdditive();q("toggleChartPlayerCraftingXP","chartPlayerCraftingXP","Crafting XP","column").asAdditive();q("toggleChartPlayerGold","chartPlayerGold","Gold").asElementChart("gold");q("toggleChartPlayerGoldLooted","chartPlayerGoldLooted",
"Gold Looted","column").asAdditive();q("toggleChartPlayerPlatinum","chartPlayerPlatinum","Platinum").asElementChart("platinum");q("toggleChartPlayerCrystal","chartPlayerCrystal","Crystals").asElementChart("premium");q("toggleChartPlayerMaterial","chartPlayerMaterial","Material").asElementChart("crafting_materials");q("toggleChartPlayerFragment","chartPlayerFragment","Fragments").asElementChart("gem_fragments");q("toggleChartPlayerFood","chartPlayerFood","Food").asElementChart("food");q("toggleChartPlayerWood",
"chartPlayerWood","Wood").asElementChart("wood");q("toggleChartPlayerIron","chartPlayerIron","Iron").asElementChart("iron");q("toggleChartPlayerStone","chartPlayerStone","Stone").asElementChart("stone");q("toggleChartMonsterSlain","chartMonsterSlain","Monsters Slain").asGameStatChart("AllTimeKills");q("toggleChartGoldLooted","chartGoldLooted","Gold Looted").asGameStatChart("AllTimeGoldLooted");q("toggleChartGoldInGame","chartGoldInGame","Gold in Game").asGameStatChart("AllTimeCurrentGold");q("toggleChartResourcesInGame",
"chartResourcesInGame","Resources in Game").asGameStatChart("AllTimeCurrentRes");q("toggleChartPlatinumInGame","chartPlatinumInGame","Platinum in Game").asGameStatChart("AllTimeCurrentPlat");q("toggleChartMaterialInGame","chartMaterialInGame","Crafting Materials in Game").asGameStatChart("AllTimeCurrentMats");q("toggleChartFragmentInGame","chartFragmentInGame","Gem Fragments in Game").asGameStatChart("AllTimeCurrentFrags");q("toggleChartHarvests","chartHarvests","Harvests").asGameStatChart("AllTimeHarvests");
q("toggleChartResourcesHarvested","chartResourcesHarvested","Resources Harvested").asGameStatChart("AllTimeResources");q("toggleChartItemsFound","chartItemsFound","Items found").asGameStatChart("AllTimeItemsFound");q("toggleChartMarketCrystals","chartMarketCrystals","Crystals");q("toggleChartMarketPlatinum","chartMarketPlatinum","Platinum");q("toggleChartMarketFood","chartMarketFood","Food");q("toggleChartMarketWood","chartMarketWood","Wood");q("toggleChartMarketIron","chartMarketIron","Iron");q("toggleChartMarketStone",
"chartMarketStone","Stone");q("toggleChartMarketMaterial","chartMarketMaterial","Material");q("toggleChartMarketFragment","chartMarketFragment","Fragments");f();modules.ajaxHooks.register("autobattle.php",c);modules.ajaxHooks.register("autotrade.php",b);modules.ajaxHooks.register("autocraft.php",d);modules.ajaxHooks.register("game_stats.php",e);modules.ajaxHooks.registerAutoSend("game_stats.php",{},modules.constants.ChartUpdateInterval);modules.uiScriptMenu.addLink("Charts",C);RoAModule.prototype.load.apply(this)},
load:function(){F=modules.templates.chartWindow;this.continueLoad()},toggle:function(){v.toggle()}});D.prototype.constructor=D;modules.chartWindow=new D})(modules.jQuery);
(function(a){function c(){a("head").append('<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.0/spectrum.min.css"><style>.sp-replacer{border: 1px solid #01b0aa; background: #01736D;}</style>');a("#profileOptionProfile").after(' . <input type="text" id="profileOptionColor" />');a("#profileOptionColor").spectrum({showInput:!0,showInitial:!0,allowEmpty:!0,clickoutFiresChange:!1,change:function(c){null==c&&a("#profileOptionUsername").text()in e?(e[a("#profileOptionUsername").text()]=
"white",b(),delete e[a("#profileOptionUsername").text()]):(e[a("#profileOptionUsername").text()]=c.toHexString(),b());localStorage.peopleMod=JSON.stringify(e)}});var c=new MutationObserver(function(c){c.forEach(function(c){null!==c.addedNodes&&b();a("#profileOptionUsername").text()in e?a("#profileOptionColor").spectrum("set",e[a("#profileOptionUsername").text()]):a("#profileOptionColor").spectrum("set","")})});c.observe(a("#chatMessageList")[0],{childList:!0,characterData:!0});c.observe(a("#profileOptionTooltip")[0],
{attributes:!0,characterData:!0})}function b(){a("#chatMessageList").find(".profileLink").each(function(){if(a(this).text()in e){var b=a(this).next(),c=a(this).closest("li").find("span:eq(2)").text();-1==c.indexOf("Whisper")&&"["!=c&&b.css("color",e[a(this).text()])}})}function d(){RoAModule.call(this,"Chat People Colors")}var e={};localStorage.peopleMod&&(e=JSON.parse(localStorage.peopleMod));d.prototype=Object.spawn(RoAModule.prototype,{load:function(){a("head").append("<style>.ui-icon, .ui-widget-content .ui-icon {background-image: none;}.closeCustomWindow {position: absolute;right: -12px;top: -12px;font-size: 20px;text-align: center;border-radius: 40px;border: 1px solid black;background: transparent linear-gradient(to bottom, #008681 0%, #003533 100%) repeat scroll 0% 0%;width: 30px;}.closeCustomWindow a {text-decoration: none;}.customWindowWrapper {display: none;z-index: 99;position: absolute !important;top: 120px;left: 15%;}.customWindowContent {padding: 5px;border-bottom-right-radius: 5px;border-bottom-left-radius: 5px}.customWindowContent table {width: 100%;font-size: 12px;}.customWindowContent tbody {border: 1px solid #01B0AA;border-top: none;}.customWindowContent th {text-align: center;color: #FF7;border: 1px solid #01B0AA;}.customWindowContent thead th {background-color: #01736D;font-size: 14px;}.customWindowContent td {text-align: center;}.customWindowContent .bRight {border-right: 1px solid #01B0AA;}</style>");
modules.constants.ENABLE_CHAT_USER_COLOR_PICKER&&c();RoAModule.prototype.load.apply(this)}});d.prototype.constructor=d;modules.chatPeopleColor=new d})(modules.jQuery);
(function(a){function c(a,b,c,d){return{cID:a,res:b,name:c,on:"undefined"!==typeof d?d:name}}function b(b){var d,e=b,f=!0;if("GLOBAL"===b)b="Global";else if("CLAN"===b)b="Clan";else if("AREA"===b.substr(0,4))b="Area";else if("HELP"===b)b="Help";else if("STAFF"===b)b="Staff";else if("TRADE"===b)b="Trade";else{if("Market"===b)return c("CMDRC_4000_8045237_CHC",!0,"");if("Whispers Log"===b)return c("UW_7593725_3480021_CHC",!0,b,e);if("Wires Log"===b)return c("WC_0952340_3245901_CHC",!0,b,e);if("Server Messages"===
b)return c("SML_325725_2338723_CHC",!0,b,e);if(b.match(/^Level:\s+[0-9]+/))return c("CMDRC_4000_8045237_CHC",!0,"",e)}var k={Global:"GLOBAL",Clan:"CLAN",Area:"AREA",Help:"HELP",Staff:"STAFF",Trade:"TRADE"};"undefined"!==typeof k[e]&&(e=k[e]);d=0;a("select#chatChannel option").each(function(c,e){a(e).attr("name")==="channel"+b&&(d=a(e).attr("value"))});-1!==h.channelsSettings.channelMerger.groups.indexOf(e)&&(d="MCG_105704_4581101_CHC_MCGID_"+y[e]);"GLOBAL"==e&&(d=1E9);"Event"==e&&(d=2E9);0===d&&(f=
!1,d="2");return c(d,f,b,e)}function d(b,c){var d="";try{d=a('.chatChannel[data-id="'+c+'"]').css("background-color")}catch(e){d=""}""!==d&&"undefined"!==typeof d||a(".chatChannel").each(function(b,w){a(w).attr("data-id")===c&&(d=a(w).css("background-color"))});"SML_325725_2338723_CHC"===b?d="#007f23":"CMDRC_4000_8045237_CHC"===b?d="#317D80":"UW_7593725_3480021_CHC"===b?d="#DE3937":"WC_0952340_3245901_CHC"===b&&(d="#39DE37");return d}function e(b){var c=a("#channelTab"+b.channelID);if(0===c.length){if(b.muted)return;
a("<div>").attr("id","channelTab"+b.channelID).attr("data-channel",b.channelID).addClass("border2 ui-element channelTab").css({color:b.channelColor}).appendTo("#channelTabList");c=a("#channelTab"+b.channelID)}c.text("#"+b.channelName).css({color:b.channelColor});b.newMessages&&!b.muted&&(0===a(".Ch"+b.channelID+"Badge").length?a("<span>").addClass("ChBadge").addClass("border2").addClass("Ch"+b.channelID+"Badge").text(b.newMessagesCount).appendTo("#channelTab"+b.channelID):a(".Ch"+b.channelID+"Badge").text(b.newMessagesCount));
b.muted&&a("<span>").addClass("ChBadge fa fa-times border2 ui-element").appendTo("#channelTab"+b.channelID)}function f(a,b){return Math.round(Math.random()*(b-a))+a}function k(){for(var a="#",b=0;6>b;b++)a+=Math.floor(15*Math.random()).toString(16);return a}function g(a,b){for(var c=["a","e","i","o","u"],d="rtzpsdfghklmnbvc".split(""),e=f(a,b),k="",g=0;g<e;g++){var n=0===g%2?c:d;0===g&&(n=.5>Math.random()?c:d);n=n[f(0,n.length-1)];k+=0===g?n.toUpperCase():n}return k}function n(){a("<div>").attr("id",
"channelTabListWrapper").insertBefore("#chatMessageListWrapper");a("<div>").attr("id","channelTabList").appendTo("#channelTabListWrapper");a("<div>").attr("id","channelPreviewWrapper").addClass("border2").addClass("ui-element").appendTo("body");a("<h5>").css("text-align","center").appendTo("#channelPreviewWrapper");a("<div>").attr("id","channelPreviewActions").appendTo("#channelPreviewWrapper");a("<span>").addClass("border2 ui-element fa fa-check sapphire cpa").attr("id","CPAReset").attr("title",
"Mark as read").appendTo("#channelPreviewActions");a("<span>").addClass("border2 ui-element fa fa-eraser emerald cpa").attr("id","CPAPurge").attr("title","Clear channel of all messages").appendTo("#channelPreviewActions");a("<span>").addClass("border2 ui-element fa fa-unlink ruby cpa").attr("id","CPARemove").attr("title","Clear the channel and remove it from tabs\nIf any new messages pop into it, it will come back.").appendTo("#channelPreviewActions");a("<div>").attr("id","channelPreviewContent").appendTo("#channelPreviewWrapper");
a("<div>").attr("id","channelPreviewMessages").css({padding:"2px"}).appendTo("#channelPreviewContent");a("#channelPreviewContent").mCustomScrollbar({scrollInertia:250,mouseWheel:{scrollAmount:40}});a("<div>").attr("id","channelTabContextMenu").addClass("ui-element navSection").appendTo("body");a("<a>").attr("id","chTabCTMenuMute").text("Mute channel").addClass("cctmButton").appendTo("#channelTabContextMenu");a("<span>").addClass("ui-element fa fa-bell-slash titanium").prependTo("#chTabCTMenuMute");
a("<a>").attr("id","chTabCTMenuUnMute").text("Un-mute channel").addClass("cctmButton").appendTo("#channelTabContextMenu");a("<span>").addClass("ui-element fa fa-bell platinum").prependTo("#chTabCTMenuUnMute");a("<a>").attr("id","chTabCTMenuReset").text("Mark as read").addClass("cctmButton").appendTo("#channelTabContextMenu");a("<span>").addClass("ui-element fa fa-check sapphire").prependTo("#chTabCTMenuReset");a("<a>").attr("id","chTabCTMenuLast").text("Show history").addClass("cctmButton").appendTo("#channelTabContextMenu");
a("<span>").addClass("ui-element fa fa-history materials").prependTo("#chTabCTMenuLast");a("<a>").attr("id","chTabCTMenuPurge").text("Purge messages").addClass("cctmButton").appendTo("#channelTabContextMenu");a("<span>").addClass("ui-element fa fa-eraser emerald").prependTo("#chTabCTMenuPurge");a("<a>").attr("id","chTabCTMenuRemove").text("Remove from tabs").addClass("cctmButton").appendTo("#channelTabContextMenu");a("<span>").addClass("ui-element fa fa-unlink ruby").prependTo("#chTabCTMenuRemove");
a("<a>").attr("id","chTabCTMenuLeave").text("Leave channel").addClass("cctmButton").appendTo("#channelTabContextMenu");a("<span>").addClass("ui-element fa fa-arrow-right diamond").prependTo("#chTabCTMenuLeave");a("<a>").attr("id","chTabCTMenuColor").text("Change color").addClass("cctmButton").appendTo("#channelTabContextMenu");a("<span>").addClass("ui-element fa fa-crosshairs crystals").prependTo("#chTabCTMenuColor");a("#channelTabContextMenu").hide();a("<div>").attr("id","ToASettingsWindow").addClass("border2 ui-element").appendTo("body");
a("<h5>").css("text-align","center").text("TabsOfAvabur v"+h.version+" - Settings").appendTo("#ToASettingsWindow");a("<div>").attr("id","ToASWMenu").appendTo("#ToASettingsWindow");var b=a("<div>").addClass("col-sm-6 text-center"),c=b.clone().appendTo("#ToASWMenu"),d=b.clone().appendTo("#ToASWMenu");a("<button>").attr("type","button").attr("id","ToAScriptOptions").addClass("btn btn-primary btn-block").text("Script options").appendTo(c);a("<button>").attr("type","button").attr("id","ToAChannelMerger").addClass("btn btn-primary btn-block").text("(WIP) Channel Manager").appendTo(d);
a("<div>").addClass("clearfix").appendTo("#ToASettingsWindow");a("<div>").attr("id","ToASettingsWindowContent").appendTo("#ToASettingsWindow");a("<div>").attr("id","ToASettingsScriptSettings").appendTo("#ToASettingsWindowContent");var c=a("<h6>").addClass("text-center"),d=a("<label>"),e=a("<input>").attr({type:"checkbox"}).addClass("settingsChanger"),b=b.clone().removeClass("text-center");c.clone().text("Script settings").appendTo("#ToASettingsScriptSettings");b.clone().append(d.clone().text(" Allow channel message purging").prepend(e.clone().attr("data-setting",
"purge").prop("checked",h.scriptSettings.purge))).appendTo("#ToASettingsScriptSettings");b.clone().append(d.clone().text(" Allow removing channel form tabs").prepend(e.clone().attr("data-setting","channel_remove").prop("checked",h.scriptSettings.channel_remove))).appendTo("#ToASettingsScriptSettings");b.clone().append(d.clone().text(" Preview channel on tab hover").prepend(e.clone().attr("data-setting","preview").prop("checked",h.scriptSettings.preview))).appendTo("#ToASettingsScriptSettings");b.clone().append(d.clone().text(" Allow marking channels as read").prepend(e.clone().attr("data-setting",
"preview_reset").prop("checked",h.scriptSettings.preview_reset))).appendTo("#ToASettingsScriptSettings");b.clone().append(d.clone().text(" Group wires into their own channel").prepend(e.clone().attr("data-setting","group_wires").prop("checked",h.scriptSettings.group_wires))).appendTo("#ToASettingsScriptSettings");b.clone().append(d.clone().text(" Make @username clickable").prepend(e.clone().attr("data-setting","at_username").prop("checked",h.scriptSettings.at_username))).appendTo("#ToASettingsScriptSettings");
b.clone().append(d.clone().html(" Make '/join channel' clickable. <span class='fa fa-info-circle ToATooltip' title='After you click on the link, the chat message will be filled with a /join channel text.' data-toggle='tooltip' data-placement='top' data-html='true'></span>").prepend(e.clone().attr("data-setting","join_channel_link").prop("checked",h.scriptSettings.join_channel_link))).appendTo("#ToASettingsScriptSettings");b.clone().append(d.clone().html(" Autojoin clicked channel. <span class='fa fa-info-circle ToATooltip' title='This is designed to work with the previous option to replace the /join <a>channel</a> message.<br>If this option is enabled, the prefilled message to join a channel will be automatically sent.' data-toggle='tooltip' data-placement='top' data-html='true'></span>").prepend(e.clone().attr("data-setting",
"auto_join").prop("checked",h.scriptSettings.auto_join))).appendTo("#ToASettingsScriptSettings");b.clone().append(d.clone().html(" Enable Ni[c]kname shortcut").prepend(e.clone().attr("data-setting","profile_tooltip_nickname").prop("checked",h.scriptSettings.profile_tooltip_nickname))).appendTo("#ToASettingsScriptSettings");b.clone().append(d.clone().html(" Enable @m[e]ntion shortcut").prepend(e.clone().attr("data-setting","profile_tooltip_mention").prop("checked",h.scriptSettings.profile_tooltip_mention))).appendTo("#ToASettingsScriptSettings");
b.clone().append(d.clone().html(" Enable [Q]uickscope shortcut").prepend(e.clone().attr("data-setting","profile_tooltip_quickscope").prop("checked",h.scriptSettings.profile_tooltip_quickscope))).appendTo("#ToASettingsScriptSettings");a("<div>").addClass("clearfix").appendTo("#ToASettingsScriptSettings");a("<div>").attr("id","ToASettingsChannelMerger").appendTo("#ToASettingsWindowContent");c.clone().text("Muted channels").appendTo("#ToASettingsChannelMerger");a("<div>").attr("id","ToASChMMutedChannelsHolder").addClass("border2 ui-element ToASChannelsHolder").appendTo("#ToASettingsChannelMerger");
a("<div>").addClass("clearfix").appendTo("#ToASettingsWindow");c.clone().text("Channel Merger").appendTo("#ToASettingsChannelMerger");a("<div>").attr("id","ToASChMMergedChannelsHolder").addClass("border2 ui-element ToASChannelsHolder incsort").appendTo("#ToASettingsChannelMerger").before(d.clone().text("Available Channels:"));a("<div>").attr("id","ToASChMMergedChannelsGroupsHolder").addClass("ui-element ToASChannelsHolder").appendTo("#ToASettingsChannelMerger").before();b=d.clone().text("Channel Groups:").insertBefore("#ToASChMMergedChannelsGroupsHolder");
a("<button>").addClass("fa fa-plus btn btn-primary emerald pull-right btn-xs").attr("id","ToASChMAddGroup").insertAfter(b);a("<div>").addClass("clearfix").appendTo("#ToASettingsChannelMerger");a("<div>").addClass("clearfix").appendTo("#ToASettingsWindow");a("<div>").attr("id","ToASettingsSaved").text("Settings have been saved and are applied").addClass("text-center small").appendTo("#ToASettingsWindow");a("<span>").attr("id","ToASettingsWindowClose").addClass("fa fa-times border2 ui-element").appendTo("#ToASettingsWindow");
b=a("<span>").text(" \u00b7 ");b.clone().addClass("ToAPONickname").toggleClass("hidden",!h.scriptSettings.profile_tooltip_nickname).appendTo("#profileOptionTooltip");a("<a>").addClass("ToAPONickname").toggleClass("hidden",!h.scriptSettings.profile_tooltip_nickname).text("Ni[c]kname").attr("id","profileOptionNick").appendTo("#profileOptionTooltip");b.clone().addClass("ToAPOMention").toggleClass("hidden",!h.scriptSettings.profile_tooltip_mention).appendTo("#profileOptionTooltip");a("<a>").addClass("ToAPOMention").toggleClass("hidden",
!h.scriptSettings.profile_tooltip_mention).text("@m[e]ntion").attr("id","profileOptionAt").appendTo("#profileOptionTooltip");b.clone().addClass("ToAPOQuickscope").toggleClass("hidden",!h.scriptSettings.profile_tooltip_quickscope).appendTo("#profileOptionTooltip");a("<a>").addClass("ToAPOQuickscope").toggleClass("hidden",!h.scriptSettings.profile_tooltip_quickscope).text("[Q]uickscope").attr("id","profileOptionQuickScope").appendTo("#profileOptionTooltip");a("#ToASettingsWindow").hide();a("#ToASettingsScriptSettings").hide();
a("#ToASettingsChannelMerger").hide();a("#ToASettingsSaved").hide();a(".ToATooltip").tooltip();a("#ToASettingsWindow").draggable({handle:"h5"})}function l(){clearTimeout(J);var b=JSON.stringify(h);localStorage.setItem("ToAOPTS",b);a("#ToASettingsSaved").show();J=setTimeout(function(){a("#ToASettingsSaved").fadeOut()},3E3)}function m(){var b=t;p[b].newMessages=!1;p[b].newMessagesCount=0;e(p[b]);a("#channelPreviewWrapper").hide();a("#channelTabContextMenu").hide()}function r(b,c){b="undefined"===typeof b?
h.scriptSettings.channel_remove:b;var d=t,e='Are you sure you want purge the "'+p[d].channelName+'" channel'+(b?" and remove it from tabs":"")+"?\nThis only affects your screen.";if(("undefined"===typeof c?0:c)||window.confirm(e))a(".chc_"+d).remove(),m(),b&&(a("#channelTab"+d).remove(),a("#channelTabMain").click(),a("#channelPreviewWrapper").hide())}function x(){var a=localStorage.getItem("ToAOPTS");try{var b=JSON.parse(a);"undefined"!==typeof b.scriptSettings&&("undefined"!==typeof b.scriptSettings.purge&&
(h.scriptSettings.purge=!!b.scriptSettings.purge),"undefined"!==typeof b.scriptSettings.channel_remove&&(h.scriptSettings.channel_remove=!!b.scriptSettings.channel_remove),"undefined"!==typeof b.scriptSettings.preview&&(h.scriptSettings.preview=!!b.scriptSettings.preview),"undefined"!==typeof b.scriptSettings.preview_reset&&(h.scriptSettings.preview_reset=!!b.scriptSettings.preview_reset),"undefined"!==typeof b.scriptSettings.group_wires&&(h.scriptSettings.group_wires=!!b.scriptSettings.group_wires),
"undefined"!==typeof b.scriptSettings.at_username&&(h.scriptSettings.at_username=!!b.scriptSettings.at_username),"undefined"!==typeof b.scriptSettings.join_channel_link&&(h.scriptSettings.join_channel_link=!!b.scriptSettings.join_channel_link),"undefined"!==typeof b.scriptSettings.auto_join&&(h.scriptSettings.auto_join=!!b.scriptSettings.auto_join),"undefined"!==typeof b.scriptSettings.profile_tooltip_nickname&&(h.scriptSettings.profile_tooltip_nickname=!!b.scriptSettings.profile_tooltip_nickname),
"undefined"!==typeof b.scriptSettings.profile_tooltip_mention&&(h.scriptSettings.profile_tooltip_mention=!!b.scriptSettings.profile_tooltip_mention),"undefined"!==typeof b.scriptSettings.profile_tooltip_quickscope&&(h.scriptSettings.profile_tooltip_quickscope=!!b.scriptSettings.profile_tooltip_quickscope));if("undefined"!==typeof b.channelsSettings&&"undefined"!==typeof b.version&&("undefined"!==typeof b.channelsSettings.mutedChannels&&Array.isArray(b.channelsSettings.mutedChannels)&&(h.channelsSettings.mutedChannels=
b.channelsSettings.mutedChannels),"undefined"!==typeof b.channelsSettings.channelMerger)){if("undefined"!==typeof b.channelsSettings.channelMerger.groups&&Array.isArray(b.channelsSettings.channelMerger.groups))for(var c in b.channelsSettings.channelMerger.groups){var d=b.channelsSettings.channelMerger.groups[c];"string"===typeof d&&-1===h.channelsSettings.channelMerger.groups.indexOf(d)&&(h.channelsSettings.channelMerger.groups.push(d),y[d]=g(3,5)+"_"+f(5,9))}"undefined"!==typeof b.channelsSettings.channelMerger.mapping&&
"object"===typeof b.channelsSettings.channelMerger.mapping&&(h.channelsSettings.channelMerger.mapping=b.channelsSettings.channelMerger.mapping);"undefined"!==typeof b.channelsSettings.channelMerger.defaultChannels&&"object"===typeof b.channelsSettings.channelMerger.defaultChannels&&(h.channelsSettings.channelMerger.defaultChannels=b.channelsSettings.channelMerger.defaultChannels)}l()}catch(e){localStorage.removeItem("ToAOPTS")}}function A(a,b,c){p[b]={channelName:a,channelID:b,channelColor:c,messages:0,
newMessages:!1,newMessagesCount:0,muted:-1!==h.channelsSettings.mutedChannels.indexOf(a)}}function q(){a("#chatChannel option").each(function(c,e){var f=a(e).text(),f=b(f),k=f.cID,g=d(k,f.name);"undefined"===typeof p[k]&&A(f.on,k,g)});"undefined"===typeof p[1E9]&&A("GLOBAL",1E9,d(1E9,"Global"));"undefined"===typeof p[2E9]&&A("Event",2E9,d(2E9,"Event"))}function C(){if(!h.scriptSettings.profile_tooltip_quickscope)return!1;a("#chatMessage").text("/whois "+a("#profileOptionTooltip").attr("data-username"));
a("#chatSendMessage").click();a("#profileOptionTooltip").hide();setTimeout(function(){a("#channelTabCMDRC_4000_8045237_CHC").click()},1E3)}function D(){if(!h.scriptSettings.profile_tooltip_mention)return!1;a("#chatMessage").append(" @"+a("#profileOptionTooltip").attr("data-username")).focus();a("#profileOptionTooltip").hide()}function v(){if(!h.scriptSettings.profile_tooltip_nickname)return!1;var b=a("#profileOptionTooltip").attr("data-username");a.confirm({title:"Nickname for "+b,message:'<input type="text" id="ToASPONicknameName" style="width:100%;" placeholder="Leave blank to unnickname">',
buttons:{Nickname:{"class":"green",action:function(){var c=a("#ToASPONicknameName").val();c.match(/^\s*$/)?a("#chatMessage").text("/unnickname "+b):a("#chatMessage").text("/nickname "+b+" "+c);a("#chatSendMessage").click()}},Cancel:{"class":"red",action:function(){}}}});setTimeout(function(){a("#ToASPONicknameName").val("").focus()},500)}function F(b,c){var d=a("<div>").addClass("border2 incsort input-group"),e=a("<div>").addClass("input-group-btn"),f=a("<button>").addClass("ToASChMChGRemove btn btn-primary btn-xs ruby"),
k=a("<input>").attr({type:"text",name:"mcg_cn"}).addClass("ToASChMmcgName"),g="MCG_105704_4581101_CHC_MCGID_"+y[c],d=d.clone().attr({id:g,"data-group":c}).appendTo("#ToASChMMergedChannelsGroupsHolder"),e=e.clone().appendTo(d);f.clone().attr("data-gnid",b).html('<i class="fa fa-times"></i>').appendTo(e);k.clone().val(c).attr("data-gnid",b).appendTo(d)}function z(c){2<a("#chatChannel option").length&&a("#chatMessageList li:not(.processed)").each(function(c,f){var g=a(f).text(),g=g.replace(/^\[X\]\s*/,
""),g=g.replace(/\s+/g," "),n=g.match(/^\[([^\]]+)\]\s*(\[([^\]]+)\])?\s*(.*)/),w=0===g.replace(/^\[[0-9]+\s+[a-zA-Z]+\,\s*[0-9]+\]\s*/,"").indexOf("Clan Message of the Day:");g.replace(/^\[[0-9]+\s+[a-zA-Z]+\,\s*[0-9]+\]\s*/,"").indexOf("Message of the Day:");var l=g.match(/^\[[^\]]+\]\s*\[\s+.*\s+]$/),m=g.match(/^\[[^\]]+\]\s*Whisper\s*(to|from)\s*([^:]+)/),m=m&&0===a(this).closest("li").find("span:eq(2)").text().indexOf("Whisper"),q=g.match(/^\[[^\]]+\]\s*(You|[a-zA-Z]+)\s*wired\s*.*\s*(you|[a-zA-Z]+)\.$/),
C=0<a(f).children(".chat_notification").length||a(f).hasClass("chat_notification"),x="websocket_reconnect_line"===a(f).attr("id"),g="",g=B.match(/^[0-9]+$/)?p[B].channelName:0===B.indexOf("MCG_105704_4581101_CHC")?p[B].channelName:-1!==G.indexOf(B)?p[B].channelName:B,v=b(g);null!==n&&(g="undefined"===typeof n[3]?"Main":n[3],"Main"!==g&&(n="["===a(this).closest("li").find("span:eq(2)").text(),v=g.match(/^Level:\s+[0-9]+/),n||null!==v||(g="Main")),v=b(g));w?v=b("CLAN"):l?v=b("Server Messages"):m?v=
b("Whispers Log"):q&&h.scriptSettings.group_wires&&(v=b("Wires Log"));w=v.cID;g=v.on;"CMDRC_4000_8045237_CHC"!==w&&"SML_325725_2338723_CHC"!==w&&"WC_0952340_3245901_CHC"!==w&&(C||x)&&(w=v.cID);"CMDRC_4000_8045237_CHC"===w&&(g="Info Channel");l=d(w,v.name);"undefined"!==typeof h.channelsSettings.channelMerger.mapping[g]&&(g=h.channelsSettings.channelMerger.mapping[g],h.channelsSettings.channelMerger.groups.indexOf(g),w="MCG_105704_4581101_CHC_MCGID_"+y[g],l=k());B!=w&&a(f).addClass("hidden");a(f).addClass("processed");
a(f).addClass("chc_"+w);"undefined"===typeof p[w]&&A(g,w,l);w!=B&&(p[w].newMessages=!0,p[w].newMessagesCount++);p[w].messages++;-1!==h.channelsSettings.mutedChannels.indexOf(g)&&a(f).remove();h.scriptSettings.at_username&&a(f).html(a(f).html().replace(/\@([a-zA-Z]+)/g,'@<a class="profileLink">$1</a>'));h.scriptSettings.join_channel_link&&a(f).html(a(f).html().replace(/\/join\s+([^\s]+)\s*([^\s<]+)?/,'/join <a class="joinChannel">$1</a> <span class="jcPWD">$2</span>'));e(p[w])});"undefined"===typeof c&&
setTimeout(z,500);"chatMessageWrapper"===a("#chatWrapper>div:nth-child(2)").attr("id")&&a("#channelTabListWrapper").insertBefore("#chatMessageListWrapper")}function u(){x();a("<link>").attr({rel:"stylesheet",href:"//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css"}).appendTo("head");n();a("<div>").attr("id","ToASettings").addClass("border2 ui-element ToASettings").prependTo("#channelTabList");a("<span>").addClass("fa").addClass("fa-cogs").css({color:"#ffd700",fontWeight:500}).appendTo("#ToASettings");
z();a("#channelTabListWrapper").mCustomScrollbar({axis:"x",advanced:{autoExpandHorizontalScroll:!0}});a("#channelTabList").sortable({items:".channelTab",distance:5});a("#channelTabList").disableSelection();setTimeout(function(){a("#channelTabList > div:nth-child(2)").click()},2E3)}function E(){RoAModule.call(this,"Chat Tabs")}var h={scriptSettings:{purge:!0,channel_remove:!1,preview:!0,preview_reset:!1,group_wires:!1,at_username:!0,join_channel_link:!0,auto_join:!1,profile_tooltip_nickname:!0,profile_tooltip_mention:!0,
profile_tooltip_quickscope:!0},channelsSettings:{channelMerger:{groups:[],mapping:{},defaultChannels:{}},mutedChannels:[]},version:"3.1"},y={},p={},B="Main",H="up",G=["SML_325725_2338723_CHC","CMDRC_4000_8045237_CHC","UW_7593725_3480021_CHC","WC_0952340_3245901_CHC"],I,t,J=0;a(document).on("ajaxSuccess",function(a,b,c,d){a="";b=["up","down"];d.hasOwnProperty("cs")?-1!==b.indexOf(d.cs)&&(a=d.cs):d.hasOwnProperty("p")&&d.p.hasOwnProperty("chatScroll")&&-1!==b.indexOf(d.p.chatScroll)&&(a=d.p.chatScroll);
""!==a&&(H=a)});a(document).on("change",".settingsChanger",function(b){b=a(this).attr("data-setting");h.scriptSettings[b]=a(this).prop("checked");b=b.match("^profile_tooltip_([a-z]+)");null!==b&&(b=b[1],b=b.charAt(0).toUpperCase()+b.substr(1),a(".ToAPO"+b).toggleClass("hidden"));l()});a(document).on("click",".channelTab",function(c){a(".channelTab").removeClass("chTabSelected");c=a(this).attr("data-channel");p[c].newMessages=!1;p[c].newMessagesCount=0;e(p[c]);a("#chatMessageList > li:not(.hidden)").addClass("hidden");
a(".chc_"+c).removeClass("hidden");a("#channelTab"+c).addClass("chTabSelected");a("#channelPreviewWrapper").hide();B=c;if(null===c.match(/^[0-9]+$/)){var d=p[c].channelName;-1!==h.channelsSettings.channelMerger.groups.indexOf(d)&&"undefined"!==typeof h.channelsSettings.channelMerger.defaultChannels[d]&&(c=b(h.channelsSettings.channelMerger.defaultChannels[d]).cID)}0<a("#chatChannel option[value="+c+"]").length&&a("#chatChannel").val(c);"down"===H&&setTimeout(function(){a("#chatMessageListWrapper").mCustomScrollbar("scrollTo",
"bottom")},500)});a(document).on("click","#CPAReset, #chTabCTMenuReset",function(){m()});a(document).on("click","#CPAReset, #chTabCTMenuLast",function(){var b=p[t].channelName,c="/last "+b;if("CLAN"===b)c="/c /last";else if(-1!==h.channelsSettings.channelMerger.groups.indexOf(b))"undefined"!==typeof h.channelsSettings.channelMerger.defaultChannels[b]&&(c="/last "+h.channelsSettings.channelMerger.defaultChannels[b]);else if("Whispers Log"===b)c="/w /last";else if(-1!==G.indexOf(t))return!1;a("#chatMessage").text(c);
a("#chatSendMessage").click()});a(document).on("click","#CPAPurge, #chTabCTMenuPurge",function(){var b="chTabCTMenuPurge"===a(this).attr("id");r(!1,b)});a(document).on("click","#CPARemove, #chTabCTMenuRemove",function(){var b="chTabCTMenuRemove"===a(this).attr("id");r(!0,b)});a(document).on("click","#chTabCTMenuLeave",function(){var b=p[t].channelName;r(!0,!0);a("#chatMessage").text("/leave "+b);a("#chatSendMessage").click()});a(document).on("click","#chTabCTMenuColor",function(){if(-1!==t.indexOf("MCG_105704_4581101_CHC")){var b=
k();p[t].channelColor=b;e(p[t])}else a.alert("Tab color change failed! Please try again!","Group tab color change")});a(document).on("click","#chTabCTMenuMute",function(){if("undefined"!==typeof t){var a=p[t].channelName;-1===h.channelsSettings.mutedChannels.indexOf(a)&&(h.channelsSettings.mutedChannels.push(a),l());p[t].muted=!0;e(p[t])}});a(document).on("click","#chTabCTMenuUnMute",function(){if("undefined"!==typeof t){var a=h.channelsSettings.mutedChannels.indexOf(p[t].channelName);-1!==a&&(h.channelsSettings.mutedChannels.splice(a,
1),l());p[t].muted=!1;e(p[t])}});a(document).on("mouseover",".channelTab",function(b){clearTimeout(I);var c=a(this).attr("data-channel");t=c;if(h.scriptSettings.preview){b=p[c].channelName;var d=a("#channelPreviewWrapper");a(this);var e={top:a(this).offset().top+25+"px"},g="There are no new messages in this channel!";if(!0===p[c].newMessages){var f=[];a(".chc_"+c).each(function(b,d){b<p[c].newMessagesCount&&f.push(a(d).html())});g=f.join("<br>")}a("#channelPreviewMessages").html(g);a(this).offset().left>
a(document).width()/2?e.left=a(this).offset().left-d.width()+50+"px":e.left=a(this).offset().left+50+"px";d.css(e).children("h5").text("'"+b+"' preview");h.scriptSettings.preview_reset?a("#CPAReset").show():a("#CPAReset").hide();h.scriptSettings.purge?a("#CPAPurge").show():a("#CPAPurge").hide();h.scriptSettings.channel_remove?a("#CPARemove").show():a("#CPARemove").hide()}});a(document).on("mouseover",function(b){clearTimeout(I);if("undefined"!==typeof t&&"undefined"!==typeof p[t]){var c=a("#channelTab"+
t),d=a("#channelPreviewWrapper"),e=!0===p[t].newMessages,g=a(b.target).closest(c).length||a(b.target).closest(d).length;I=setTimeout(function(){h.scriptSettings.preview&&g&&e?d.show(0,function(){"down"===H&&a("#channelPreviewContent").mCustomScrollbar("scrollTo","bottom")}):d.hide()},g?500:250)}});a(document).on("contextmenu",".channelTab",function(b){b.preventDefault();var c={top:b.pageY+"px"};a(this).offset().left>a(document).width()/2?c.left=b.pageX-a(this).width()+"px":c.left=b.pageX+"px";h.scriptSettings.preview_reset?
a("#chTabCTMenuReset").show():a("#chTabCTMenuReset").hide();h.scriptSettings.purge?a("#chTabCTMenuPurge").show():a("#chTabCTMenuPurge").hide();h.scriptSettings.channel_remove?a("#chTabCTMenuRemove").show():a("#chTabCTMenuRemove").hide();-1!==h.channelsSettings.mutedChannels.indexOf(p[t].channelName)?(a("#chTabCTMenuUnMute").show(),a("#chTabCTMenuMute").hide()):(a("#chTabCTMenuMute").show(),a("#chTabCTMenuUnMute").hide());t.match(/^[a-z]+/i)?(a("#chTabCTMenuLeave").hide(),-1!==t.indexOf("MCG_105704_4581101_CHC")?
a("#chTabCTMenuColor").show():a("#chTabCTMenuColor").hide()):(a("#chTabCTMenuColor").hide(),a("#chTabCTMenuLeave").show());-1!==G.indexOf(t)&&"UW_7593725_3480021_CHC"!==t?a("#chTabCTMenuLast").hide():a("#chTabCTMenuLast").show();a("#channelTabContextMenu").css(c).show();a("#channelPreviewWrapper").hide();return!1});a(document).on("click","#ToASettings",function(){a("#modalBackground").show();a("#ToASettingsWindow").show();q();var b=a("<span>").addClass("ChMChannelWrapper border2"),c=a("<span>").addClass("ChMMChX ui-element fa fa-times ruby");
a("#ToASChMMutedChannelsHolder").html("");a("#ToASChMMergedChannelsHolder").html("");a("#ToASChMMergedChannelsGroupsHolder").html("");var d="",e;for(e in h.channelsSettings.mutedChannels){var d=h.channelsSettings.mutedChannels[e],g=b.clone().append(d).appendTo("#ToASChMMutedChannelsHolder");c.clone().attr("data-channel",d).prependTo(g)}d="";a("#ToASChMMergedChannelsGroupsHolder").html("");for(var f in h.channelsSettings.channelMerger.groups)F(f,h.channelsSettings.channelMerger.groups[f]);for(var k in p)k.match(/^[0-9]+$/)&&
(d=p[k].channelName,c=b.clone().attr("data-channel",d).text(d),"undefined"!==typeof h.channelsSettings.channelMerger.mapping[d]?(e=h.channelsSettings.channelMerger.mapping[d],g=h.channelsSettings.channelMerger.groups.indexOf(e),g="MCG_105704_4581101_CHC_MCGID_"+y[e],h.channelsSettings.channelMerger.defaultChannels[e]===d?c.insertAfter("#"+g+" > input"):c.appendTo("#"+g)):c.appendTo("#ToASChMMergedChannelsHolder"));d="";a(".incsort").sortable({items:"span",connectWith:".incsort",receive:function(b,
c){d=a(c.item[0]).attr("data-channel");var e=a(this).attr("data-group");"undefined"===typeof e?delete h.channelsSettings.channelMerger.mapping[d]:h.channelsSettings.channelMerger.mapping[d]=e;l()},update:function(b,c){var d=a(this).attr("data-group");if("undefined"!==typeof d){var e=a(b.target).children("span"),e=a(e[0]).attr("data-channel");h.channelsSettings.channelMerger.defaultChannels[d]=e;l()}}}).disableSelection()});a(document).on("click",".ChMMChX",function(){var c=a(this).attr("data-channel"),
d=b(c).cID;p[d].muted=!1;e(p[d]);c=h.channelsSettings.mutedChannels.indexOf(c);-1!==c&&h.channelsSettings.mutedChannels.splice(c,1);a(this).parent().fadeOut("slow",function(){a(this).remove()});l()});a(document).on("click",".joinChannel",function(){var b=a(this).text().replace(/^,+|,+$/gm,"");a("#chatMessage").text("/join "+b);b=a(this).parent().find(".jcPWD").text();a("#chatMessage").append(" "+b);h.scriptSettings.auto_join&&a("#chatSendMessage").click()});a(document).on("click",function(b){a("#channelTabContextMenu").hide();
var c=a("#ToASettingsWindow");if(!(a(b.target).closest("#ToASettingsWindow").length||a(b.target).closest("#ToASettings").length||a(b.target).closest("#confirmOverlay").length||a(b.target).closest(".replenishStamina").length)||a(b.target).closest("#ToASettingsWindowClose").length)c.hide(),a("#ToASettingsChannelMerger").hide(),a("#ToASettingsScriptSettings").hide(),a(b.target).closest("#ToASettingsWindowClose").length&&a("#modalBackground").fadeOut()});a(document).on("click","#ToAScriptOptions, #ToAChannelMerger",
function(){"ToAScriptOptions"===a(this).attr("id")?a("#ToASettingsChannelMerger").slideUp(function(){a("#ToASettingsScriptSettings").slideDown()}):a("#ToASettingsScriptSettings").slideUp(function(){a("#ToASettingsChannelMerger").slideDown()})});a(document).on("click","#profileOptionQuickScope",C);a(document).on("click","#profileOptionAt",D);a(document).on("click","#profileOptionNick",v);a(document).on("keydown",function(b){var c=b.which;"block"===a("#profileOptionTooltip").css("display")&&(81===c?
C():69===c?(D(),b.preventDefault()):67===c&&v())});a(document).on("change",".ToASChMmcgName",function(){var b=a(this).val(),c=a(this).attr("data-gnid"),d=h.channelsSettings.channelMerger.groups[c],g=y[d];delete y[d];y[b]=g;h.channelsSettings.channelMerger.groups[c]=b;a(this).parent().attr("data-group",b);for(var f in h.channelsSettings.channelMerger.mapping)h.channelsSettings.channelMerger.mapping[f]===d&&(h.channelsSettings.channelMerger.mapping[f]=b);c="MCG_105704_4581101_CHC_MCGID_"+y[b];"undefined"!==
typeof p[c]&&(p[c].channelName=b,e(p[c]));l()});a(document).on("click","#ToASChMAddGroup",function(){a.confirm({title:"New Group Name",message:'<input type="text" id="ToASChMNewgroupName" style="width:100%;">',buttons:{Create:{"class":"green",action:function(){var b=a("#ToASChMNewgroupName").val();b.match(/^\s*$/)&&(b=g(7,13));h.channelsSettings.channelMerger.groups.push(b);y[b]=g(3,5)+"_"+f(5,9);a("#ToASettings").click()}},Cancel:{"class":"red",action:function(){}}}});a("#ToASChMNewgroupName").focus()});
a(document).on("click",".ToASChMChGRemove",function(){var b=a(this);a.confirm({title:"Group Delete Confirmation",message:"Are you sure you want to remove this channel group?",buttons:{Yes:{"class":"green",action:function(){var c=b.attr("data-gnid"),d=h.channelsSettings.channelMerger.groups[c],e;for(e in h.channelsSettings.channelMerger.mapping)h.channelsSettings.channelMerger.mapping[e]===d&&delete h.channelsSettings.channelMerger.mapping[e];h.channelsSettings.channelMerger.groups.splice(c,1);c="MCG_105704_4581101_CHC_MCGID_"+
y[d];a("#channelTab"+c).remove();delete p[c];delete y[d];delete h.channelsSettings.channelMerger.defaultChannels[d];a("#chatMessageList li").attr("class","");l();a("#channelTabList > div:nth-child(2)").click();z("reload");a("#ToASettings").click()}},No:{"class":"red",action:function(){}}}})});E.prototype=Object.spawn(RoAModule.prototype,{load:function(){u();RoAModule.prototype.load.apply(this)}});E.prototype.constructor=E;modules.chatTabs=new E})(modules.jQuery);
(function(a){function c(){a("#toggleDonationPercent").attr("checked",!1);for(var b=0;b<e.length;b++){var c=0,d=a(e[b]);d.each(function(){c+=parseInt(a(this).attr("title").replace(/,/g,""))});d.each(function(){a(this).attr({origFormat:a(this).text(),percFormat:(100*parseInt(a(this).attr("title").replace(/,/g,""))/c).toFixed(2)+" %"})})}}function b(){RoAModule.call(this,"Clan Donations")}var d,e=".donator_list_crystals .donator_list_platinum .donator_list_gold .donator_list_food .donator_list_wood .donator_list_iron .donator_list_stone .donator_list_experience".split(" ");
b.prototype=Object.spawn(RoAModule.prototype,{continueLoad:function(){a("#myClanDonationTable").before(a(d));a("#toggleDonationPercent").change(function(){for(var b=a(this).is(":checked")?"percFormat":"origFormat",c=0;c<e.length;c++)a(e[c]).each(function(){a(this).text(a(this).attr(b))})});modules.ajaxHooks.register("clan_donations.php",c);RoAModule.prototype.load.apply(this)},load:function(){d=modules.templates.clanDonationPercent;this.continueLoad()}});b.prototype.constructor=b;modules.clanDonations=
new b})(modules.jQuery);
(function(a){function c(){n&&e()}function b(a){var b=modules.createAutomateAction(modules.automateActionTypes.JQueryClick);b.control="#dungeonNavigation";b.findClause='[data-direction="'+a.stringValue+'"]';modules.automateControl.add(b)}function d(a,b){for(var c=[];a[b];){var d=modules.dungeonDirections.parseInt(a[b].dir);c.push({to:a[b].id,dir:d.id});console.log(d.key+" -> "+b);b=a[b].id}return c=c.reverse()}function e(){if(modules.automateControl.isIdle())if(modules.session.dungeonNeedsUpdate)console.log("DA: dungeonNeedUpdate");else if(modules.settings.settings.dungeonData.currentRoomId){var a=
modules.settings.settings.dungeonData.rooms[modules.settings.settings.dungeonData.currentRoomId];if(0<a.e.length){modules.session.dungeonNeedsUpdate=!0;var c=modules.createAutomateAction(modules.automateActionTypes.JQueryClick);c.control="#dungeonEnemyList";c.findClause=".dungeon_fight";modules.automateControl.add(c)}else if(a.s)modules.session.dungeonNeedsUpdate=!0,c=modules.createAutomateAction(modules.automateActionTypes.JQueryClick),c.control="#dungeonSearch",modules.automateControl.add(c);else{for(var e=
-1,c=0;4>c;c++)if(a.m[c]&&!a.ml[c]){e=c;break}if(0<=e)c=modules.dungeonDirections.parseInt(e),modules.session.dungeonNeedsUpdate=!0,modules.logger.log("Dungeon Auto: Moving to unexplored cell on "+c.key),b(c);else{b:{for(var c=r.UnexploredNeighbor,a=[modules.settings.settings.dungeonData.currentRoomId],e=[],g={},f=0;0<a.length;){f++;if(300<=f){console.error("findTargetRoom exceeded max iterations!");break}var k=modules.settings.settings.dungeonData.rooms[a.pop()];switch(c){case r.UnexploredNeighbor:for(var l=
0;4>l;l++)if(1===k.m[l]&&!k.ml[l]){a=d(g,k.id);break b}break;case r.Exit:if(1===k.m[4]){a=d(g,k.id);break b}break;case r.Id:if(void 0===k.id){a=d(g,k.id);break b}}e.push(k.id);for(l=0;4>l;l++)0===k.m[l]||!k.ml[l]||e.includes(k.ml[l])||a.includes(k.ml[l])||(a.push(k.ml[l]),g[k.ml[l]]={id:k.id,dir:l})}a=void 0}if(a&&0<a.length){modules.session.dungeonNeedsUpdate=!0;for(c=0;c<a.length;c++)b(modules.dungeonDirections.parseInt(a[c].dir));c=modules.createAutomateAction(modules.automateActionTypes.Delay);
c.time=500;modules.automateControl.add(c)}else modules.logger.warn("Could not find Backtrack path!"),n=!1}}}else console.log("DA: room unknown");else console.log("DA: Waiting for AutomateControl")}function f(){n=!n;k();modules.automateControl.clear()}function k(){l.text("Auto "+(n?"On":"Off"))}function g(){RoAModule.call(this,"Dungeon Automate");this.addDependency("dungeonTracker")}var n=!1,l,m,r={UnexploredNeighbor:0,Exit:1,Id:2};g.prototype=Object.spawn(RoAModule.prototype,{load:function(){if(this.checkDependencies()){l=
a("<a></a>");l.click(f);k();var b=a('<div class="bt1 mt10 center"></div>');b.append(l);a("#dungeonInfo").append(b);var d=a("<a>(A) Next</a>");d.click(e);b=a('<div class="bt1 mt10 center"></div>');b.append(d);a("#dungeonInfo").append(b);m=modules.createInterval("DungeonAutoAction");m.set(c,200);RoAModule.prototype.load.apply(this)}}});g.prototype.constructor=g;modules.dungeonAutomate=new g})(modules.jQuery);
(function(){function a(){this.addDirection(new c("East",0,"east",2));this.addDirection(new c("North",1,"north",3));this.addDirection(new c("West",2,"west",0));this.addDirection(new c("South",3,"south",1));this.rebuildOpposites()}function c(a,c,e,f){this.name="DIR_"+a;this.key=a;this.id=c;this.stringValue=e;this.oppositeId=f}a.prototype=Object.spawn(RoAModule.prototype,{directions:{},addDirection:function(a){this.directions[a.key]&&console.error("Dungeon Direction already defined: "+a.key);this.directions[a.key]=
a},parseInt:function(a){for(var c in this.directions){var e=this.directions[c];if(e.id==a)return e}console.warn("Unknown Movement Direction: "+a)},parse:function(a,c){c=c||!1;for(var e in this.directions){var f=this.directions[e];if(f.stringValue==a||c&&a.includes(f.stringValue))return f}console.warn("Unknown Movement Direction: "+a)},rebuildOpposites:function(){for(var a in this.directions)this.directions[a].opposite=this.parseInt(this.directions[a].oppositeId)}});a.prototype.constructor=a;c.prototype=
Object.spawn(RoAModule.prototype,{key:null,id:null,stringValue:"",opposite:null,oppositeId:null});c.prototype.constructor=c;modules.dungeonDirections=new a})();
(function(a){function c(){x()}function b(b){-1===b.url.indexOf("dungeon_")?a("#dMCW").hide():modules.settings.dungeonMap.hasData&&a("#dMCW").show()}function d(b){if(b.json.hasOwnProperty("data")&&b.json.data.hasOwnProperty("map")){modules.settings.dungeonMap.hasData=!0;modules.settings.dungeonMap.cf!==b.json.data.floor&&(modules.settings.dungeonMap.r={},modules.settings.dungeonMap.cf=b.json.data.floor);var c=b.json.data,d={},e=a(c.map).text().replace("\u2193","v"),e=btoa(JSON.stringify(e));modules.settings.dungeonMap.r.hasOwnProperty(e)?
d=JSON.parse(JSON.stringify(modules.settings.dungeonMap.r[e])):(d.pe="",d.ps="",d.pn="",d.pw="",d.t=e);null===modules.settings.dungeonMap.ct&&(modules.settings.dungeonMap.ct=e);d.e=c.e?1:0;d.s=c.s?1:0;d.n=c.n?1:0;d.w=c.w?1:0;d.r=!!c.search;d.b=Object.keys(c.enemies).length;modules.settings.dungeonMap.r[d.t]=d;c=(c=b.json.hasOwnProperty("m")&&b.json.m.match(/You walked (east|south|north|west)/))?b.json.m.match(/You walked (east|south|north|west)/):!1;!1!==c&&(c=c[1].match(/^./)[0],modules.settings.dungeonMap.ct!==
d.t&&("undefined"!==typeof modules.settings.dungeonMap.r[modules.settings.dungeonMap.ct]&&(modules.settings.dungeonMap.r[modules.settings.dungeonMap.ct]["p"+c]=d.t,modules.settings.dungeonMap.r[d.t]["p"+{s:"n",n:"s",e:"w",w:"e"}[c]]=modules.settings.dungeonMap.ct),modules.settings.dungeonMap.ct=d.t));modules.settings.save();f()}}function e(b){a("#dungeonMapCanvas").attr({width:modules.settings.dungeonMap.size.width,height:modules.settings.dungeonMap.size.height});f(!1)}function f(){if(0===a("#dungeonMapCanvas").length){var b=
a("<div>").attr("id","dMCW").css({position:"absolute",top:0,left:0}).addClass("border2 ui-component").appendTo("body");a("<canvas>").attr({id:"dungeonMapCanvas",width:"325",height:"325"}).appendTo("#dMCW");b.draggable({handle:"#dungeonMapCanvas"}).resizable({stop:e});l=document.getElementById("dungeonMapCanvas");m=l.getContext("2d")}r=[];m.clearRect(0,0,l.width,l.height);k(modules.settings.dungeonMap.ct,Math.floor(l.width/2),Math.floor(l.height/2),1)}function k(a,b,c,d){"undefined"===typeof d&&(d=
0);if(-1===r.indexOf(a)){var e=modules.settings.dungeonMap.r[a];r.push(a);m.fillStyle="#333";m.fillRect(b-4,c-4,10,10);g(b,c,"top",!e.n);g(b,c,"left",!e.w);g(b,c,"right",!e.e);g(b,c,"bot",!e.s);e.r&&(m.fillStyle=modules.constants.DungeonRoomSearchedColor,m.strokeStyle=modules.constants.DungeonRoomSearchedColor,m.arc(b,c,2,0,2*Math.PI),m.fill());0<e.b&&(m.fillStyle=modules.constants.DungeonRoomHasEnemiesColor,m.strokeStyle=modules.constants.DungeonRoomHasEnemiesColor,m.arc(b,c,2,0,2*Math.PI),m.fill());
1===d&&(m.fillStyle=modules.constants.DungeonPlayerColor,m.strokeStyle=modules.constants.DungeonPlayerColor,m.arc(b,c,2,0,2*Math.PI),m.fill());1===e.n&&""!==e.pn&&k(e.pn,b,c-10);1===e.w&&""!==e.pw&&k(e.pw,b-10,c);1===e.e&&""!==e.pe&&k(e.pe,b+10,c);1===e.s&&""!==e.ps&&k(e.ps,b,c+10)}}function g(a,b,c,d){d?(m.strokeStyle=modules.constants.DungeonWallColor,m.fillStyle="#ffffff",m.beginPath(),"top"===c?(m.moveTo(a-5,b-5),m.lineTo(a+5,b-5)):"left"===c?(m.moveTo(a-5,b-5),m.lineTo(a-5,b+5)):"right"===c?
(m.moveTo(a+5,b+5),m.lineTo(a+5,b-5)):"bot"===c&&(m.moveTo(a-5,b+5),m.lineTo(a+5,b+5)),m.stroke(),m.closePath()):m.strokeStyle="#333"}function n(){RoAModule.call(this,"Dungeon Map");this.addDependency("dungeonTracker")}var l,m,r,x=function(){console.log("Resetting Dungeon Map");modules.settings.dungeonMap={r:{},cf:0,ct:null,v:modules.constants.DungeonMapVersion,hasData:!1}};n.prototype=Object.spawn(RoAModule.prototype,{load:function(){if(this.checkDependencies()){if(null==modules.settings.dungeonMap)x();
else try{null!=modules.settings.dungeonMap&&null!=modules.settings.dungeonMap.v&&modules.settings.dungeonMap.v==modules.constants.DungeonMapVersion||x()}catch(a){x()}modules.ajaxHooks.register("dungeon_leave.php",c);modules.ajaxHooks.register("dungeon_info.php",d);modules.ajaxHooks.register("dungeon_move.php",d);modules.ajaxHooks.register("dungeon_search.php",d);modules.ajaxHooks.registerAll(b);RoAModule.prototype.load.apply(this)}}});n.prototype.constructor=n;modules.dungeonMap=new n})(modules.jQuery);
(function(){function a(a){if(a.json.data){var b;modules.settings.settings.dungeonData.currentRoomId&&(b=modules.settings.settings.dungeonData.rooms[modules.settings.settings.dungeonData.currentRoomId]);var c=a.json.data.e,d=a.json.data.n,e=a.json.data.s,f=a.json.data.w,k=a.json.data.d,q=a.json.data.search;k&&(modules.settings.settings.dungeonData.exitRoom=b.id);var c=[c?1:0,d?1:0,f?1:0,e?1:0,k?1:0],d=[],C;for(C in a.json.data.enemies)d.push(a.json.data.enemies[C].id);b?(b.m=c,b.e=d,b.s=q):(modules.settings.settings.dungeonData.currentRoomId=
modules.settings.settings.dungeonData.nextRoomId++,b={id:modules.settings.settings.dungeonData.currentRoomId,m:c,ml:[null,null,null,null],e:d,s:q,x:!0});b.pos=[modules.settings.settings.dungeonData.position[0],modules.settings.settings.dungeonData.position[1]];modules.settings.settings.dungeonData.rooms[b.id]=b;modules.session.dungeonNeedsUpdate=!1}}function c(b){a(b)}function b(a){f()}function d(b){if(b.json){var c=modules.settings.settings.dungeonData.currentRoomId,d=modules.dungeonDirections.parse(b.json.m,
!0),e=modules.settings.settings.dungeonData.rooms[c];modules.settings.settings.dungeonData.currentRoomId=e.ml[d.id]?e.ml[d.id]:null;d===modules.dungeonDirections.directions.North?modules.settings.settings.dungeonData.position[1]+=1:d===modules.dungeonDirections.directions.South?--modules.settings.settings.dungeonData.position[1]:d===modules.dungeonDirections.directions.East?modules.settings.settings.dungeonData.position[0]+=1:d===modules.dungeonDirections.directions.West&&--modules.settings.settings.dungeonData.position[0];
a(b);e.ml[d.id]=modules.settings.settings.dungeonData.currentRoomId;modules.settings.settings.dungeonData.rooms[modules.settings.settings.dungeonData.currentRoomId].ml[d.opposite.id]=c}else f(),modules.session.dungeonNeedsUpdate=!0}function e(a){}function f(){modules.settings.settings.dungeonData={rooms:{},nextRoomId:1,exitRoom:null,version:3,position:[0,0]}}function k(){RoAModule.call(this,"Dungeon Tracker")}k.prototype=Object.spawn(RoAModule.prototype,{load:function(){modules.settings.settings.dungeonData&&
3==modules.settings.settings.dungeonData.version||f();modules.ajaxHooks.register("dungeon_leave.php",b);modules.ajaxHooks.register("dungeon_info.php",a);modules.ajaxHooks.register("dungeon_search.php",c);modules.ajaxHooks.register("dungeon_move.php",d);modules.ajaxHooks.register("dungeon_battle.php",e);RoAModule.prototype.load.apply(this)}});k.prototype.constructor=k;modules.dungeonTracker=new k})();
(function(a){function c(){e.toggle()}function b(){RoAModule.call(this,"Dungeon Window")}var d,e;b.prototype=Object.spawn(RoAModule.prototype,{continueLoad:function(){e=a(d);e.appendTo("body");e.draggable({handle:"#dungeonWindowTitle"});e.resizable();e.hide();a("#dungeonWindowClose").click(function(){e.hide()});modules.uiScriptMenu.addLink("Dungeon",c);RoAModule.prototype.load.apply(this)},load:function(){d=modules.templates.dungeonWindow;this.continueLoad()}});b.prototype.constructor=b;modules.dungeonWindow=
new b})(modules.jQuery);
modules.templates={chartWindow:'<div id="gameCharts" class="border2 ui-component chartWindow">     <div id="gameChartWindow" class="ui-element border2" style="height: 100%">         <h5 id="gameChartTitle" class="center toprounder">Charts</h5>         <span class="closeModal"><a id="gameChartWindowClose">\u00d7</a></span>         <div id="gameChartContent" class="mCSB_container" style="height: 100%">             <div id="gameChartControls" class="col-xs-12 col-md-12 center mt10" style="display: block">                 <div id="gameChartReset" class="btn btn-primary">Reset</div>                 <div id="gameChartRedraw" class="btn btn-primary">Redraw</div>                 <div id="gameChartDebugData" class="btn btn-primary">Debug</div>                 <div id="gameChartTimeMinute" class="btn btn-primary">Minute</div>                 <div id="gameChartTimeHour" class="btn btn-primary">Hour</div>                 <div id="gameChartTimeDay" class="btn btn-primary">Day</div>                 <div id="gameChartTimeMonth" class="btn btn-primary">Month</div>                 <div id="gameChartStorageSizeWrapper" style="display: inline-block">                     <span>Storage Size: </span>                     <span id="gameChartStorageSize">0</span>                     <span>bytes</span>                 </div>             </div>             <div id="gameChartCategoryTabs" style="height: 100%">                 <div class="col-xs-12 col-md-12 mt10" style="display: block">                     <div id="toggleGameChartPlayer" class="btn btn-primary">Player Charts</div>                     <div id="toggleGameChartStats" class="btn btn-primary">Game Stats</div>                     <div id="toggleGameChartMarket" class="btn btn-primary">Market</div>                 </div>                 <div id="gameChartPlayerTabs" class="chartCategoryTab">                     <div class="col-xs-12 col-md-12 mt10" style="display: block">                         <div id="toggleChartPlayerBattleXP" class="btn btn-primary">Battle XP</div>                         <div id="toggleChartPlayerHarvestXP" class="btn btn-primary">Harvest XP</div>                         <div id="toggleChartPlayerCraftingXP" class="btn btn-primary">Crafting XP</div>                         <div id="toggleChartPlayerGold" class="btn btn-primary">Gold</div>                         <div id="toggleChartPlayerGoldLooted" class="btn btn-primary">Gold Looted</div>                         <div id="toggleChartPlayerPlatinum" class="btn btn-primary">Platinum</div>                         <div id="toggleChartPlayerCrystal" class="btn btn-primary">Crystals</div>                         <div id="toggleChartPlayerMaterial" class="btn btn-primary">Material</div>                         <div id="toggleChartPlayerFragment" class="btn btn-primary">Fragments</div>                         <div id="toggleChartPlayerFood" class="btn btn-primary">Food</div>                         <div id="toggleChartPlayerWood" class="btn btn-primary">Wood</div>                         <div id="toggleChartPlayerIron" class="btn btn-primary">Iron</div>                         <div id="toggleChartPlayerStone" class="btn btn-primary">Stone</div>                     </div>                     <div id="chartPlayerBattleXP" class="chartTab"></div>                     <div id="chartPlayerHarvestXP" class="chartTab"></div>                     <div id="chartPlayerCraftingXP" class="chartTab"></div>                     <div id="chartPlayerGold" class="chartTab"></div>                     <div id="chartPlayerGoldLooted" class="chartTab"></div>                     <div id="chartPlayerPlatinum" class="chartTab"></div>                     <div id="chartPlayerCrystal" class="chartTab"></div>                     <div id="chartPlayerMaterial" class="chartTab"></div>                     <div id="chartPlayerFragment" class="chartTab"></div>                     <div id="chartPlayerFood" class="chartTab"></div>                     <div id="chartPlayerWood" class="chartTab"></div>                     <div id="chartPlayerIron" class="chartTab"></div>                     <div id="chartPlayerStone" class="chartTab"></div>                 </div>                 <div id="gameChartStatsTabs" class="chartCategoryTab">                     <div class="col-xs-12 col-md-12 mt10" style="display: block">                         <div id="toggleChartMonsterSlain" class="btn btn-primary">Monsters Slain</div>                         <div id="toggleChartGoldLooted" class="btn btn-primary">Gold Looted</div>                         <div id="toggleChartGoldInGame" class="btn btn-primary">Gold in Game</div>                         <div id="toggleChartResourcesInGame" class="btn btn-primary">Resources in Game</div>                         <div id="toggleChartPlatinumInGame" class="btn btn-primary">Platinum in Game</div>                         <div id="toggleChartMaterialInGame" class="btn btn-primary">Material in Game</div>                         <div id="toggleChartFragmentInGame" class="btn btn-primary">Fragments in Game</div>                         <div id="toggleChartHarvests" class="btn btn-primary">Harvests</div>                         <div id="toggleChartResourcesHarvested" class="btn btn-primary">Resources Harvested</div>                         <div id="toggleChartItemsFound" class="btn btn-primary">Items Found</div>                     </div>                     <div id="chartMonsterSlain" class="chartTab"></div>                     <div id="chartGoldLooted" class="chartTab"></div>                     <div id="chartGoldInGame" class="chartTab"></div>                     <div id="chartResourcesInGame" class="chartTab"></div>                     <div id="chartPlatinumInGame" class="chartTab"></div>                     <div id="chartMaterialInGame" class="chartTab"></div>                     <div id="chartFragmentInGame" class="chartTab"></div>                     <div id="chartHarvests" class="chartTab"></div>                     <div id="chartResourcesHarvested" class="chartTab"></div>                     <div id="chartItemsFound" class="chartTab"></div>                 </div>                 <div id="gameChartMarketTabs" class="chartCategoryTab">                     <div class="col-xs-12 col-md-12 mt10" style="display: block">                         <div id="toggleChartMarketCrystals" class="btn btn-primary">Crystals</div>                         <div id="toggleChartMarketPlatinum" class="btn btn-primary">Platinum</div>                         <div id="toggleChartMarketFood" class="btn btn-primary">Food</div>                         <div id="toggleChartMarketWood" class="btn btn-primary">Wood</div>                         <div id="toggleChartMarketIron" class="btn btn-primary">Iron</div>                         <div id="toggleChartMarketStone" class="btn btn-primary">Stone</div>                         <div id="toggleChartMarketMaterial" class="btn btn-primary">Material</div>                         <div id="toggleChartMarketFragment" class="btn btn-primary">Fragments</div>                     </div>                     <div id="chartMarketCrystals" class="chartTab"></div>                     <div id="chartMarketPlatinum" class="chartTab"></div>                     <div id="chartMarketFood" class="chartTab"></div>                     <div id="chartMarketWood" class="chartTab"></div>                     <div id="chartMarketIron" class="chartTab"></div>                     <div id="chartMarketStone" class="chartTab"></div>                     <div id="chartMarketMaterial" class="chartTab"></div>                     <div id="chartMarketFragment" class="chartTab"></div>                 </div>             </div>         </div>     </div> </div>',clanDonationPercent:'<label style="display: block; padding-left: 15px; text-indent: -15px; margin-top:-25px">     <input type="checkbox" id="toggleDonationPercent" style="width: 13px; height: 13px; padding: 0; margin: 0; vertical-align: bottom; position: relative; top: -3px; *overflow: hidden;" />     Show % </label>',
debugWindow:'<div id="debug" class="border2 ui-component debugWindow">     <div id="debugWindow" class="ui-element border2" style="height: 100%">         <h5 id="debugWindowTitle" class="center toprounder">Debug</h5>         <span class="closeModal"><a id="debugWindowClose">\u00d7</a></span>         <div id="debugWindowContent" class="mCSB_container" style="height: 100%">             <table class="avi" style="margin:auto">                 <thead>                 <tr>                     <th colspan="3">                         Request History                     </th>                 </tr>                 <tr>                     <th>Url</th>                     <th>Time</th>                     <th>Data Sent</th>                     <th>Data Received</th>                 </tr>                 </thead>                 <tbody id="debugWindowContentBody">                 </tbody>             </table>         </div>     </div> </div>',
dungeonWindow:'<div id="roaDungeon" class="border2 ui-component dungeonWindow">     <div id="dungeonWindow" class="ui-element border2" style="height: 100%">         <h5 id="dungeonWindowTitle" class="center toprounder">Dungeon</h5>         <span class="closeModal"><a id="dungeonWindowClose">\u00d7</a></span>         <div id="dungeonWindowContent" class="mCSB_container" style="height: 100%">         </div>     </div> </div>',noteWindow:'<div id="notes" class="border2 ui-component noteWindow">     <div id="noteWindow" class="ui-element border2" style="height: 100%">         <h5 id="noteTitle" class="center toprounder">Notes</h5>         <span class="closeModal"><a id="noteWindowClose">\u00d7</a></span>         <div id="noteContent" class="mCSB_container" style="height: 100%">             <div id="noteEditor"></div>         </div>     </div> </div>',
playerGainWindow:'<div id="roaPlayerGains" class="border2 ui-component gainWindow">     <div id="gainWindow" class="ui-element border2" style="height: 100%">         <h5 id="gainWindowTitle" class="center toprounder">Gains</h5>         <span class="closeModal"><a id="gainWindowClose">\u00d7</a></span>         <div id="gainWindowContent" class="mCSB_container" style="height: 100%">         </div>     </div> </div>',scriptMenu:'<div id="roaext" style="margin-bottom: 10px">     <div class="ui-element border2">         <h5 id="roaMenuTitle" class="toprounder center active"></h5>         <ul id="roaMenuContent">         </ul>     </div> </div>',
settingsWindow:'<div id="roaSettings" class="border2 ui-component settingsWindow">     <div id="settingsWindow" class="ui-element border2" style="height: 100%">         <h5 id="settingsWindowTitle" class="center toprounder">Settings</h5>         <span class="closeModal"><a id="settingsWindowClose">\u00d7</a></span>         <div id="settingsWindowContent" class="mCSB_container" style="height: 100%">         </div>     </div> </div>',timerEditor:'<div id="timerEditor" class="border2 ui-component timerEditorWindow">     <div id="timerEditorWindow" class="ui-element border2" style="height: 100%">         <h5 id="timerEditorTitle" class="center toprounder">Create Timer</h5>         <span class="closeModal"><a id="timerEditorWindowClose">\u00d7</a></span>         <div id="timerEditorContent" class="mCSB_container" style="height: 100%">             <div id="activeCustomTimers">                 <table class="avi" style="margin:auto">                     <thead>                     <tr>                         <th colspan="3">                             Active Timers                         </th>                     </tr>                     <tr>                         <th>Name</th>                         <th>Time</th>                         <th>Options</th>                     </tr>                     </thead>                     <tbody id="activeCustomTimerTableContent">                     </tbody>                 </table>             </div>             <div id="createNewCustomTimer" style="margin-top: 10px">                 <table class="avi" style="margin:auto">                     <tr>                         <th>                             <input id="customTimerOptName" class="createTimerInput"> Name</input>                         </th>                         <th>                             <input id="customTimerOptHour" class="createTimerInputTime" maxlength="2"> H</input>                             <input id="customTimerOptMinute" class="createTimerInputTime" maxlength="2"> M</input>                             <input id="customTimerOptSecond" class="createTimerInputTime" maxlength="2"> S</input>                         </th>                         <th>                             <input id="customTimerOptSound" type="checkbox" class="createTimerCheckbox">Sound</input>                             <input id="customTimerOptNotify" type="checkbox" class="createTimerCheckbox">Notification</input>                         </th>                         <th>                             <a id="customTimerCreateButton">Create</a>                         </th>                     </tr>                 </table>             </div>             <div id="createTimerFeedback" class="createTimerFeedback">             </div>         </div>     </div> </div>',
timerMenu:'<div id="timerMenu" style="margin-top: 10px">     <div class="ui-element border2">         <h5 class="toprounder center"><a id="timerEditorOpen" href="javascript:;" style="text-decoration: none!important;">Timers</a></h5>         <div id="timerMenuContents" class="row">         </div>     </div> </div>'};
(function(){function a(){for(var a in g)g[a].ended&&(g[a].delete(),delete g[a])}function c(b){a();b=b.json.m;b!==k&&-1!==b.indexOf("available again")&&(b=modules.utils.parseTimeStringLong(b)/1E3,d("Construction",b))}function b(a){(a=parseInt(a.json.m.search(/([0-9]+)\sminute/i)))&&d("Harvestron",60*a)}function d(a,b){g[a]||(g[a]=modules.createUITimer(a),g[a].sound=modules.settings.settings.notification.house.sound,g[a].notify=modules.settings.settings.notification.house.show);g[a].set(b);g[a].resume()}
function e(b){a();if(b.json.p&&b.json.p.house_timers&&!(0>=b.json.p.house_timers.length))for(var c=0;c<b.json.p.house_timers.length;c++)d(b.json.p.house_timers[c].n,b.json.p.house_timers[c].next)}function f(){RoAModule.call(this,"House Monitor")}var k,g={};f.prototype=Object.spawn(RoAModule.prototype,{load:function(){modules.ajaxHooks.register("house.php",c);modules.ajaxHooks.register("house_harvest_job.php",b);modules.ajaxHooks.registerAutoSend("house.php",{},modules.constants.HouseUpdateInterval);
modules.ajaxRegisterAutoActions(e);RoAModule.prototype.load.apply(this)}});f.prototype.constructor=f;modules.houseMonitor=new f})();
(function(a){function c(){RoAModule.call(this,"UI Action Shortcuts")}c.prototype=Object.spawn(RoAModule.prototype,{load:function(){var b=a("#roaMenu"),c=a("<a href='javascript:;' data-delegate-click='#loadMobList' class='avi-tip avi-menu-shortcut' title='Open Battle'/>"),e=a("<a href='javascript:;' data-delegate-click='#loadFishing' class='avi-tip avi-menu-shortcut' title='Open Fishing'/>"),f=a("<a href='javascript:;' data-delegate-click='#loadWoodcutting' class='avi-tip avi-menu-shortcut' title='Open Lumber Mill'/>"),
k=a("<a href='javascript:;' data-delegate-click='#loadMining' class='avi-tip avi-menu-shortcut' title='Open Mine'/>"),g=a("<a href='javascript:;' data-delegate-click='#loadStonecutting' class='avi-tip avi-menu-shortcut' title='Open Quarry'/>");a("#navigationWrapper").css("padding-top",b.height()).find("ul").append(a('<li class="avi-menu"/>').append(c).append(e).append(f).append(k).append(g));modules.utils.svg(c,modules.urls.svg.sword_clash);modules.utils.svg(e,modules.urls.svg.fishing);modules.utils.svg(f,
modules.urls.svg.log);modules.utils.svg(k,modules.urls.svg.metal_bar);modules.utils.svg(g,modules.urls.svg.stone_block);RoAModule.prototype.load.apply(this)}});c.prototype.constructor=c;modules.uiActionShortcuts=new c})(modules.jQuery);
(function(a){function c(){n.toggle()}function b(){var b=a("#debugWindowContentBody");b.empty();for(var c in l){var d=a('<a href="javascript:;">Log to Console</a>').click({key:c},function(a){console.log("DEBUG: Printing data for "+a.data.key);console.log(l[a.data.key].data)}),e=a('<a href="javascript:;">Log to Console</a>').click({key:c},function(a){console.log("DEBUG: Printing Sent data for "+a.data.key);console.log(l[a.data.key].dataSent)}),f=l[c].time.getHours()+":"+l[c].time.getMinutes()+":"+l[c].time.getSeconds(),
g=a("<tr></tr>");g.append(a("<td>"+c+"</td>"));g.append(a("<td>"+f+"</td>"));g.append(a("<td></td>").append(e));g.append(a("<td></td>").append(d));b.append(g)}}function d(a){l[a]?l[a].time=new Date:l[a]={time:new Date,data:null,dataSent:null}}function e(a){d(a.url);l[a.url].data=a;b()}function f(a){d(a.url);l[a.url].dataSent=a;b()}function k(){RoAModule.call(this,"UI Debug Window")}var g,n,l={};k.prototype=Object.spawn(RoAModule.prototype,{continueLoad:function(){n=a(g);n.appendTo("body");n.draggable({handle:"#debugWindowTitle"});
n.resizable();n.hide();a("#debugWindowClose").click(function(){n.hide()});modules.ajaxHooks.registerAll(e);modules.ajaxHooks.registerRcvAll(f);modules.uiScriptMenu.addLink("Debug",c);RoAModule.prototype.load.apply(this)},load:function(){g=modules.templates.debugWindow;this.continueLoad()}});k.prototype.constructor=k;modules.uiDebugWindow=new k})(modules.jQuery);
(function(a){function c(a){if(a.json.p&&a.json.p.mods){var b={},c;for(c in a.json.p.mods){var g=a.json.p.mods[c].n,n=a.json.p.mods[c].ends;g&&n&&!isNaN(n)&&(b[g]=!0,d[g]||(d[g]=modules.createUITimer(g),d[g].sound=modules.settings.settings.notification.effectExpire.sound,d[g].notify=modules.settings.settings.notification.effectExpire.show),d[g].set(n),d[g].resume())}for(g in d)b[g]||(d[g].delete(),delete d[g])}}function b(){RoAModule.call(this,"Effect Monitor")}var d={};b.prototype=Object.spawn(RoAModule.prototype,
{load:function(){modules.ajaxRegisterAutoActions(c);RoAModule.prototype.load.apply(this)}});b.prototype.constructor=b;modules.effectMonitor=new b})(modules.jQuery);
(function(){function a(a){a.json.p&&(a.json.p.event_time&&0<a.json.p.event_time?(modules.settings.settings.lastEventTime=null,e&&(e.delete(),e=null),d||(d=modules.createUITimer("Next Event"),d.sound=modules.settings.settings.notification.event.sound,d.notify=modules.settings.settings.notification.event.show),d.set(a.json.p.event_time),d.resume()):d&&(d.delete(),d=null,e||(modules.settings.settings.lastEventTime=new Date,c(0))))}function c(a){e=modules.createUITimer("Last Event");e.increment=!0;e.set(a);
e.resume()}function b(){RoAModule.call(this,"Event Monitor")}var d,e;b.prototype=Object.spawn(RoAModule.prototype,{load:function(){modules.ajaxRegisterAutoActions(a);if(modules.settings.settings.lastEventTime){var b=new Date-Date.parse(modules.settings.settings.lastEventTime);c(b)}RoAModule.prototype.load.apply(this)}});b.prototype.constructor=b;modules.eventMonitor=new b})();
(function(a){function c(){f.toggle()}function b(){var b=a(".jqte_editor").html();modules.settings.settings.notes=b}function d(){RoAModule.call(this,"UI Note Window")}var e,f;d.prototype=Object.spawn(RoAModule.prototype,{continueLoad:function(){f=a(e);f.appendTo("body");f.draggable({handle:"#noteTitle"});f.resizable();f.hide();a("#noteWindowClose").click(function(){f.hide()});a("#noteEditor").jqte();a("#noteEditor").jqteVal(modules.settings.settings.notes);modules.createInterval("noteAutoSave").set(b,
5E3);modules.uiScriptMenu.addLink("Notes",c);RoAModule.prototype.load.apply(this)},load:function(){e=modules.templates.noteWindow;this.continueLoad()}});d.prototype.constructor=d;modules.uiNoteWindow=new d})(modules.jQuery);
(function(a){function c(){RoAModule.call(this,"UI Script Menu")}var b,d;c.prototype=Object.spawn(RoAModule.prototype,{addLink:function(b,c){var k=a('<a href="javascript:;"/>');k.append(a('<li class="visible-xs-inline-block visible-sm-inline-block visible-md-block visible-lg-block">'+b+"</li>"));k.click(c);d.append(k)},continueLoad:function(){a("#navWrapper").prepend(a(b));a("#roaMenuTitle").text(GM_info.script.name+" "+GM_info.script.version);d=a("#roaMenuContent");RoAModule.prototype.load.apply(this)},
load:function(){b=modules.templates.scriptMenu;this.continueLoad()}});c.prototype.constructor=c;modules.uiScriptMenu=new c})(modules.jQuery);(function(){function a(){RoAModule.call(this,"Session Time")}var c;a.prototype=Object.spawn(RoAModule.prototype,{load:function(){c=modules.createUITimer("Session Time");c.increment=!0;c.set(0);c.resume();RoAModule.prototype.load.apply(this)}});a.prototype.constructor=a;modules.sessionTime=new a})();
(function(a){function c(){RoAModule.call(this,"Player Gain-Tracker")}c.prototype=Object.spawn(RoAModule.prototype,{load:function(){RoAModule.prototype.load.apply(this)}});c.prototype.constructor=c;modules.playerGainTracker=new c})(modules.jQuery);
(function(a){function c(){e.toggle()}function b(){RoAModule.call(this,"Player Gain Window")}var d,e;b.prototype=Object.spawn(RoAModule.prototype,{continueLoad:function(){e=a(d);e.appendTo("body");e.draggable({handle:"#gainWindowTitle"});e.resizable();e.hide();a("#gainWindowClose").click(function(){e.hide()});modules.uiScriptMenu.addLink("Player Gains",c);RoAModule.prototype.load.apply(this)},load:function(){d=modules.templates.playerGainWindow;this.continueLoad()}});b.prototype.constructor=b;modules.playerGainWindow=
new b})(modules.jQuery);
(function(){var a={Toggle:0},c=function(b,c,e,f){this.category=b;this.name=c;this.description=e;this.type=f||a.Toggle;this.load();modules.settingsWindow.loaded&&modules.settingsWindow.register(this)};c.prototype={category:null,name:null,description:null,type:null,callback:null,value:null,load:function(){modules.settings.dynamicSettings||(modules.settings.dynamicSettings={});switch(this.type){case a.Toggle:this.value=modules.settings.dynamicSettings[this.name]||!1;break;default:modules.logger.error("Unknown Setting Type: "+this.type+
" for "+this.name)}},save:function(){modules.settings.dynamicSettings||(modules.settings.dynamicSettings={});switch(this.type){case a.Toggle:modules.settings.dynamicSettings[this.name]=this.value;break;default:modules.logger.error("Unknown Setting Type: "+this.type+" for "+this.name)}}};modules.settingTypes=a;modules.createSetting=function(a,d,e,f){return new c(a,d,e,f)}})();
(function(a){function c(){this.settings=this.defaults;b=modules.createInterval("settingsAutoSave");RoAModule.call(this,"Settings")}var b;c.prototype=Object.spawn(RoAModule.prototype,{defaults:{version:modules.constants.SettingsSaveVersion,notification:{enable:!1,enableSound:!1,whisper:{sound:!0,show:!0},house:{sound:!0,show:!0},event:{sound:!0,show:!0},captcha:{sound:!1,show:!0},effectExpire:{sound:!1,show:!0}},features:{house_timer:!0},dynamicSettings:{},dungeonMap:{},dungeonData:{},chartData:{},
timerData:{},lastEventTime:null,notes:""},save:function(){GM_setValue(modules.constants.SettingsSaveKey,JSON.stringify(this.settings))},load:function(){var c=JSON.parse(GM_getValue(modules.constants.SettingsSaveKey)||"{}");c.version===modules.constants.SettingsSaveVersion&&(this.settings=a.extend(!0,this.defaults,c));b.set(function(){modules.settings.save()},modules.constants.SettingsAutoSaveInterval);RoAModule.prototype.load.apply(this)}});c.prototype.constructor=c;modules.settings=new c})(modules.jQuery);
(function(a){function c(b){var c=a('<option value="0">Disabled</option>'),d=a('<option value="1">Enabled</option>'),e=a("<select></select>");e.append(c);e.append(d);e.change({cat:b.category,name:b.name},function(a){modules.settingsWindow.settings[a.data.cat][a.data.name].value=1===parseInt(this.value);var b=a.data.cat;a=a.data.name;modules.settingsWindow.settings[b][a].callback&&modules.settingsWindow.settings[b][a].callback()});c=a('<div class="col-xs-4 col-md-2"></div>');c.append(e);e=a('<div class="col-xs-8 col-md-10">'+
b.name+"</div>");b=a('<div class="col-xs-12"></div>');b.append(c);b.append(e);e=a('<div class="row mt10"></div>');e.append(b);return e}function b(){f.toggle()}function d(){RoAModule.call(this,"Settings Window")}var e,f;d.prototype=Object.spawn(RoAModule.prototype,{settings:{},continueLoad:function(){f=a(e);f.appendTo("body");f.draggable({handle:"#settingsWindowTitle"});f.resizable();f.hide();a("#settingsWindowClose").click(function(){f.hide()});modules.uiScriptMenu.addLink("Settings",b);RoAModule.prototype.load.apply(this)},
load:function(){e=modules.templates.settingsWindow;this.continueLoad()},register:function(b){this.settings[b.category]||(this.settings[b.category]={});this.settings[b.category][b.name]=b;modules.logger.log("Rebuilding Settings Window");b=a("#settingsWindowContent");b.empty();for(var d=Object.keys(modules.settingsWindow.settings).sort(),e=0;e<d.length;e++){var f=d[e],m=modules.settingsWindow.settings[f],f=a('<div class="row"><div class="col-xs-12"><h4 class="nobg center">'+f+"</h4></div></div>");b.append(f);
for(var r in m)switch(f=m[r],f.type){case modules.settingTypes.Toggle:f=c(f);b.append(f);break;default:modules.logger.warn("Setting type not implemented in Settings Window: "+f.type)}}}});d.prototype.constructor=d;modules.settingsWindow=new d})(modules.jQuery);
(function(){function a(a,d){this.name=a;this.canEdit=d;c[a]=this;modules.uiTimerMenu.registerTimer(this)}modules.createInterval("UITimerUpdate").set(function(){for(var a in c)c[a].update()},10);var c={};a.prototype={name:null,sound:!1,notify:!1,lastUpdate:null,startValue:0,remaining:0,ended:!0,callback:null,paused:!1,canEdit:!1,increment:!1,set:function(a,c){this.startValue=this.remaining=1E3*a;this.ended=!1;this.callback=c},setFromData:function(a){this.remaining=a.r;this.startValue=a.st;this.notify=
a.n;this.sound=a.s;var c=new Date-Date.parse(a.t);if(!c||isNaN(c))c=0;this.remaining=a.r-c},end:function(){this.remaining=0},getStartTimeString:function(){return(new Date(this.startValue)).toISOString().substr(11,8)},getTimeString:function(){return(new Date(this.remaining)).toISOString().substr(11,8)},resume:function(){this.lastUpdate=new Date;this.ended=this.paused=!1},suspend:function(){this.paused=!0},delete:function(){modules.uiTimerMenu.unregisterTimer(this.name);delete c[this.name]},save:function(){return{t:new Date,
r:this.remaining,st:this.startValue,s:this.sound,n:this.notify}},update:function(){if(!this.paused){var a=new Date,c=a-this.lastUpdate;this.lastUpdate=a;this.remaining=this.increment?this.remaining+c:this.remaining-c;0>=this.remaining&&(this.remaining=0,this.ended=!0,this.suspend(),this.sound&&console.warn("TODO: implement SFX"),this.notify&&modules.notification.notice("Timer has Ended: "+this.name),this.callback&&this.callback())}}};modules.createUITimer=function(b,c){return new a(b,c)}})();
(function(a){function c(b){a("#createTimerFeedback").text(b)}function b(){RoAModule.call(this,"UI Timer Editor")}var d,e;b.prototype=Object.spawn(RoAModule.prototype,{show:function(){d.show()},continueLoad:function(){d=a(e);d.appendTo("body");d.draggable({handle:"#timerEditorTitle"});d.resizable();d.hide();a("#timerEditorWindowClose").click(function(){d.hide()});a("#customTimerCreateButton").click(function(){var b=a("#customTimerOptName").val(),d=parseInt(a("#customTimerOptHour").val()),e=parseInt(a("#customTimerOptMinute").val()),
n=parseInt(a("#customTimerOptSecond").val()),l=a("#customTimerOptSound").is(":checked"),m=a("#customTimerOptNotify").is(":checked");if(!d||isNaN(d))d=0;if(!e||isNaN(e))e=0;if(!n||isNaN(n))n=0;a("#customTimerOptName").val("");a("#customTimerOptHour").val("");a("#customTimerOptMinute").val("");a("#customTimerOptSecond").val("");!b||0>=b.length?c("Invalid name"):0>=d&&0>=e&&0>=n?c("Invalid Time set!"):(d=3600*d+60*e+n,b=modules.createUITimer(b,!0),b.sound=l,b.notify=m,b.set(d),b.resume())});RoAModule.prototype.load.apply(this)},
load:function(){e=modules.templates.timerEditor;this.continueLoad()}});b.prototype.constructor=b;modules.uiTimerEditor=new b})(modules.jQuery);
(function(a){function c(){RoAModule.call(this,"UI Timer Menu")}var b,d=function(a){modules.uiTimerMenu.deleteTimer(a.data.name)},e=function(){modules.uiTimerMenu.refreshTimerList()},f=function(){modules.uiTimerMenu.save()};c.prototype=Object.spawn(RoAModule.prototype,{activeTimers:{},activeTimerEntries:{},suspendRefresh:!1,rebuildTimerList:function(){this.suspendRefresh=!0;var b=a("#timerMenuContents");b.empty();this.activeTimerEntries={};var c=Object.keys(this.activeTimers);c.sort();for(var e=0;e<
c.length;e++){var f,m=c[e],r=this.activeTimers[c[e]].canEdit;f=a('<div class="col-xs-6 col-md-12 col-lg-5 gold timerLabel">'+m+"</div>");var x=a('<div class="col-xs-6 col-md-12 col-lg-7"/>'),A=a('<span id="avi-house-construction" class="timerValue"/>');x.append(A);r&&(r=a('<a href="javascript:;" class="timerDelete"><span>[X]</span></a>'),r.click({name:m},d),x.append(r));m=a("<div/>");m.append(f).append(x);f={entry:m,span:A};b.append(f.entry);this.activeTimerEntries[c[e]]=f}this.suspendRefresh=!1;
this.refreshTimerList()},refreshTimerList:function(){if(!this.suspendRefresh)for(var a in this.activeTimers)!0===this.activeTimers[a].ended?this.activeTimerEntries[a].span.text("Ended ("+this.activeTimers[a].getStartTimeString()+")"):this.activeTimerEntries[a].span.text(this.activeTimers[a].getTimeString())},registerTimer:function(a){this.activeTimers[a.name]=a;this.rebuildTimerList()},unregisterTimer:function(a){delete this.activeTimers[a];this.rebuildTimerList()},deleteTimer:function(a){this.activeTimers[a].delete()},
continueLoad:function(){a("#rightWrapper").append(a(b));a("#timerEditorOpen").click(function(){modules.uiTimerEditor.show()});var c=modules.settings.settings.timerData;if(c)for(var d in c){var n=modules.createUITimer(d,!0);n.setFromData(c[d]);n.resume()}modules.createInterval("timerMenuRefresh").set(e,10);modules.createInterval("timerSaveInterval").set(f,100);RoAModule.prototype.load.apply(this)},load:function(){b=modules.templates.timerMenu;this.continueLoad()},save:function(){var a={},b;for(b in this.activeTimers)this.activeTimers[b].canEdit&&
!this.activeTimers[b].callback&&(a[b]=this.activeTimers[b].save());modules.settings.settings.timerData=a}});c.prototype.constructor=c;modules.uiTimerMenu=new c})(modules.jQuery);
(function(){modules.loader.loadCallback=function(){modules.loader.register(modules.cache,!0);modules.loader.register(modules.css,!0);modules.loader.register(modules.ajaxHooks,!0);modules.loader.register(modules.uiScriptMenu,!0);modules.loader.register(modules.uiTimerMenu,!0);modules.loader.register(modules.settingsWindow,!0);modules.loader.register(modules.chartWindow);modules.loader.register(modules.chatPeopleColor);modules.loader.register(modules.chatTabs);modules.loader.register(modules.clanDonations);
modules.loader.register(modules.dungeonTracker);modules.loader.register(modules.dungeonMap);modules.loader.register(modules.dungeonWindow);modules.loader.register(modules.houseMonitor);modules.loader.register(modules.uiDebugWindow);modules.loader.register(modules.uiNoteWindow);modules.loader.register(modules.uiTimerEditor);modules.loader.register(modules.uiActionShortcuts);modules.loader.register(modules.effectMonitor);modules.loader.register(modules.eventMonitor);modules.loader.register(modules.sessionTime);
modules.loader.register(modules.playerGainTracker);modules.loader.register(modules.playerGainWindow)}})();console.log("Loading "+GM_info.script.name);modules.settings.load();modules.logger.load();modules.notification.load();"undefined"===typeof window.sessionStorage?modules.notification.incompatibility("Session storage"):"undefined"===typeof MutationObserver?modules.notification.incompatibility("MutationObserver"):modules.loader.load();
